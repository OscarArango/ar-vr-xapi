var CryptoJS=CryptoJS||function(e,m){var p={},j=p.lib={},l=function(){},f=j.Base={extend:function(a){l.prototype=this;var c=new l;return a&&c.mixIn(a),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},n=j.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=m?c:4*a.length},toString:function(a){return(a||h).stringify(this)},concat:function(a){var c=this.words,q=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var b=0;b<a;b++)c[d+b>>>2]|=(q[b>>>2]>>>24-b%4*8&255)<<24-(d+b)%4*8;else if(65535<q.length)for(b=0;b<a;b+=4)c[d+b>>>2]=q[b>>>2];else c.push.apply(c,q);return this.sigBytes+=a,this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-c%4*8,a.length=e.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var c=[],b=0;b<a;b+=4)c.push(4294967296*e.random()|0);return new n.init(c,a)}}),b=p.enc={},h=b.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++){var f=c[d>>>2]>>>24-d%4*8&255;b.push((f>>>4).toString(16)),b.push((15&f).toString(16))}return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d+=2)b[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new n.init(b,c/2)}},g=b.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var b=[],d=0;d<a;d++)b.push(String.fromCharCode(c[d>>>2]>>>24-d%4*8&255));return b.join("")},parse:function(a){for(var c=a.length,b=[],d=0;d<c;d++)b[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new n.init(b,c)}},r=b.Utf8={stringify:function(a){try{return decodeURIComponent(escape(g.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data")}},parse:function(a){return g.parse(unescape(encodeURIComponent(a)))}},k=j.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new n.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=r.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,b=c.words,d=c.sigBytes,f=this.blockSize,h=d/(4*f),h;if(a=(h=a?e.ceil(h):e.max((0|h)-this._minBufferSize,0))*f,d=e.min(4*a,d),a){for(var g=0;g<a;g+=f)this._doProcessBlock(b,g);g=b.splice(0,a),c.sigBytes-=d}return new n.init(g,d)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});j.Hasher=k.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,b){return new a.init(b).finalize(c)}},_createHmacHelper:function(a){return function(b,f){return new s.HMAC.init(a,f).finalize(b)}}});var s=p.algo={};return p}(Math);!function(){var e=CryptoJS,m,p=(m=e.lib).WordArray,j=m.Hasher,l=[],m=e.algo.SHA1=j.extend({_doReset:function(){this._hash=new p.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(f,n){for(var b=this._hash.words,h=b[0],g=b[1],e=b[2],k=b[3],j=b[4],a=0;80>a;a++){if(16>a)l[a]=0|f[n+a];else{var c=l[a-3]^l[a-8]^l[a-14]^l[a-16];l[a]=c<<1|c>>>31}c=(h<<5|h>>>27)+j+l[a],c=20>a?c+(1518500249+(g&e|~g&k)):40>a?c+(1859775393+(g^e^k)):60>a?c+((g&e|g&k|e&k)-1894007588):c+((g^e^k)-899497514),j=k,k=e,e=g<<30|g>>>2,g=h,h=c}b[0]=b[0]+h|0,b[1]=b[1]+g|0,b[2]=b[2]+e|0,b[3]=b[3]+k|0,b[4]=b[4]+j|0},_doFinalize:function(){var f=this._data,e=f.words,b=8*this._nDataBytes,h=8*f.sigBytes;return e[h>>>5]|=128<<24-h%32,e[14+(h+64>>>9<<4)]=Math.floor(b/4294967296),e[15+(h+64>>>9<<4)]=b,f.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var e=j.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=j._createHelper(m),e.HmacSHA1=j._createHmacHelper(m)}();var CryptoJS=CryptoJS||function(h,s){var f={},t=f.lib={},g=function(){},j=t.Base={extend:function(a){g.prototype=this;var c=new g;return a&&c.mixIn(a),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},q=t.WordArray=j.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=s?c:4*a.length},toString:function(a){return(a||u).stringify(this)},concat:function(a){var c=this.words,d=a.words,b=this.sigBytes;if(a=a.sigBytes,this.clamp(),b%4)for(var e=0;e<a;e++)c[b+e>>>2]|=(d[e>>>2]>>>24-e%4*8&255)<<24-(b+e)%4*8;else if(65535<d.length)for(e=0;e<a;e+=4)c[b+e>>>2]=d[e>>>2];else c.push.apply(c,d);return this.sigBytes+=a,this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-c%4*8,a.length=h.ceil(c/4)},clone:function(){var a=j.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var c=[],d=0;d<a;d+=4)c.push(4294967296*h.random()|0);return new q.init(c,a)}}),v=f.enc={},u=v.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++){var e=c[b>>>2]>>>24-b%4*8&255;d.push((e>>>4).toString(16)),d.push((15&e).toString(16))}return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b+=2)d[b>>>3]|=parseInt(a.substr(b,2),16)<<24-b%8*4;return new q.init(d,c/2)}},k=v.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;b<a;b++)d.push(String.fromCharCode(c[b>>>2]>>>24-b%4*8&255));return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;b<c;b++)d[b>>>2]|=(255&a.charCodeAt(b))<<24-b%4*8;return new q.init(d,c)}},l=v.Utf8={stringify:function(a){try{return decodeURIComponent(escape(k.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data")}},parse:function(a){return k.parse(unescape(encodeURIComponent(a)))}},x=t.BufferedBlockAlgorithm=j.extend({reset:function(){this._data=new q.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=l.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,d=c.words,b=c.sigBytes,e=this.blockSize,f=b/(4*e),f;if(a=(f=a?h.ceil(f):h.max((0|f)-this._minBufferSize,0))*e,b=h.min(4*a,b),a){for(var m=0;m<a;m+=e)this._doProcessBlock(d,m);m=d.splice(0,a),c.sigBytes-=b}return new q.init(m,b)},clone:function(){var a=j.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});t.Hasher=x.extend({cfg:j.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){x.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,d){return new a.init(d).finalize(c)}},_createHmacHelper:function(a){return function(c,d){return new w.HMAC.init(a,d).finalize(c)}}});var w=f.algo={};return f}(Math),TinCan;!function(h){for(var s=CryptoJS,f,t=(f=s.lib).WordArray,g=f.Hasher,f=s.algo,j=[],q=[],v=function(a){return 4294967296*(a-(0|a))|0},u=2,k=0;64>k;){var l;a:{l=u;for(var x=h.sqrt(l),w=2;w<=x;w++)if(!(l%w)){l=!1;break a}l=!0}l&&(8>k&&(j[k]=v(h.pow(u,.5))),q[k]=v(h.pow(u,1/3)),k++),u++}var a=[],f=f.SHA256=g.extend({_doReset:function(){this._hash=new t.init(j.slice(0))},_doProcessBlock:function(c,d){for(var b=this._hash.words,e=b[0],f=b[1],m=b[2],h=b[3],p=b[4],j=b[5],k=b[6],l=b[7],n=0;64>n;n++){if(16>n)a[n]=0|c[d+n];else{var r=a[n-15],g=a[n-2];a[n]=((r<<25|r>>>7)^(r<<14|r>>>18)^r>>>3)+a[n-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+a[n-16]}r=l+((p<<26|p>>>6)^(p<<21|p>>>11)^(p<<7|p>>>25))+(p&j^~p&k)+q[n]+a[n],g=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&f^e&m^f&m),l=k,k=j,j=p,p=h+r|0,h=m,m=f,f=e,e=r+g|0}b[0]=b[0]+e|0,b[1]=b[1]+f|0,b[2]=b[2]+m|0,b[3]=b[3]+h|0,b[4]=b[4]+p|0,b[5]=b[5]+j|0,b[6]=b[6]+k|0,b[7]=b[7]+l|0},_doFinalize:function(){var a=this._data,d=a.words,b=8*this._nDataBytes,e=8*a.sigBytes;return d[e>>>5]|=128<<24-e%32,d[14+(e+64>>>9<<4)]=h.floor(b/4294967296),d[15+(e+64>>>9<<4)]=b,a.sigBytes=4*d.length,this._process(),this._hash},clone:function(){var a=g.clone.call(this);return a._hash=this._hash.clone(),a}});s.SHA256=g._createHelper(f),s.HmacSHA256=g._createHmacHelper(f)}(Math),function(){var C=CryptoJS,C_lib,WordArray=C.lib.WordArray,C_enc,Base64=C.enc.Base64={stringify:function(wordArray){var words=wordArray.words,sigBytes=wordArray.sigBytes,map=this._map;wordArray.clamp();for(var base64Chars=[],i=0;i<sigBytes;i+=3)for(var byte1,byte2,byte3,triplet=(words[i>>>2]>>>24-i%4*8&255)<<16|(words[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|words[i+2>>>2]>>>24-(i+2)%4*8&255,j=0;j<4&&i+.75*j<sigBytes;j++)base64Chars.push(map.charAt(triplet>>>6*(3-j)&63));var paddingChar=map.charAt(64);if(paddingChar)for(;base64Chars.length%4;)base64Chars.push(paddingChar);return base64Chars.join("")},parse:function(base64Str){var base64StrLength=base64Str.length,map=this._map,paddingChar=map.charAt(64);if(paddingChar){var paddingIndex=base64Str.indexOf(paddingChar);-1!=paddingIndex&&(base64StrLength=paddingIndex)}for(var words=[],nBytes=0,i=0;i<base64StrLength;i++)if(i%4){var bits1=map.indexOf(base64Str.charAt(i-1))<<i%4*2,bits2=map.indexOf(base64Str.charAt(i))>>>6-i%4*2;words[nBytes>>>2]|=(bits1|bits2)<<24-nBytes%4*8,nBytes++}return WordArray.create(words,nBytes)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(){if("function"==typeof ArrayBuffer){var C,C_lib,WordArray=CryptoJS.lib.WordArray,superInit=WordArray.init,subInit;(WordArray.init=function(typedArray){if(typedArray instanceof ArrayBuffer&&(typedArray=new Uint8Array(typedArray)),(typedArray instanceof Int8Array||typedArray instanceof Uint8ClampedArray||typedArray instanceof Int16Array||typedArray instanceof Uint16Array||typedArray instanceof Int32Array||typedArray instanceof Uint32Array||typedArray instanceof Float32Array||typedArray instanceof Float64Array)&&(typedArray=new Uint8Array(typedArray.buffer,typedArray.byteOffset,typedArray.byteLength)),typedArray instanceof Uint8Array){for(var typedArrayByteLength=typedArray.byteLength,words=[],i=0;i<typedArrayByteLength;i++)words[i>>>2]|=typedArray[i]<<24-i%4*8;superInit.call(this,words,typedArrayByteLength)}else superInit.apply(this,arguments)}).prototype=WordArray}}(),function(){"use strict";var _reservedQSParams={statementId:!0,voidedStatementId:!0,verb:!0,object:!0,registration:!0,context:!0,actor:!0,since:!0,until:!0,limit:!0,authoritative:!0,sparse:!0,instructor:!0,ascending:!0,continueToken:!0,agent:!0,activityId:!0,stateId:!0,profileId:!0,activity_platform:!0,grouping:!0,"Accept-Language":!0};(TinCan=function(cfg){this.log("constructor"),this.recordStores=[],this.actor=null,this.activity=null,this.registration=null,this.context=null,this.init(cfg)}).prototype={LOG_SRC:"TinCan",log:function(msg,src){TinCan.DEBUG&&"undefined"!=typeof console&&console.log&&(src=src||this.LOG_SRC||"TinCan",console.log("TinCan."+src+": "+msg))},init:function(cfg){var i;if(this.log("init"),(cfg=cfg||{}).hasOwnProperty("url")&&""!==cfg.url&&this._initFromQueryString(cfg.url),cfg.hasOwnProperty("recordStores")&&void 0!==cfg.recordStores)for(i=0;i<cfg.recordStores.length;i+=1)this.addRecordStore(cfg.recordStores[i]);cfg.hasOwnProperty("activity")&&(cfg.activity instanceof TinCan.Activity?this.activity=cfg.activity:this.activity=new TinCan.Activity(cfg.activity)),cfg.hasOwnProperty("actor")&&(cfg.actor instanceof TinCan.Agent?this.actor=cfg.actor:this.actor=new TinCan.Agent(cfg.actor)),cfg.hasOwnProperty("context")&&(cfg.context instanceof TinCan.Context?this.context=cfg.context:this.context=new TinCan.Context(cfg.context)),cfg.hasOwnProperty("registration")&&(this.registration=cfg.registration)},_initFromQueryString:function(url){this.log("_initFromQueryString");var i,prop,qsParams=TinCan.Utils.parseURL(url).params,lrsProps=["endpoint","auth"],lrsCfg={},contextCfg,extended=null;if(qsParams.hasOwnProperty("actor")){this.log("_initFromQueryString - found actor: "+qsParams.actor);try{this.actor=TinCan.Agent.fromJSON(qsParams.actor),delete qsParams.actor}catch(ex){this.log("_initFromQueryString - failed to set actor: "+ex)}}if(qsParams.hasOwnProperty("activity_id")&&(this.activity=new TinCan.Activity({id:qsParams.activity_id}),delete qsParams.activity_id),(qsParams.hasOwnProperty("activity_platform")||qsParams.hasOwnProperty("registration")||qsParams.hasOwnProperty("grouping"))&&(contextCfg={},qsParams.hasOwnProperty("activity_platform")&&(contextCfg.platform=qsParams.activity_platform,delete qsParams.activity_platform),qsParams.hasOwnProperty("registration")&&(contextCfg.registration=this.registration=qsParams.registration,delete qsParams.registration),qsParams.hasOwnProperty("grouping")&&(contextCfg.contextActivities={},contextCfg.contextActivities.grouping=qsParams.grouping,delete qsParams.grouping),this.context=new TinCan.Context(contextCfg)),qsParams.hasOwnProperty("endpoint")){for(i=0;i<lrsProps.length;i+=1)prop=lrsProps[i],qsParams.hasOwnProperty(prop)&&(lrsCfg[prop]=qsParams[prop],delete qsParams[prop]);for(i in qsParams)qsParams.hasOwnProperty(i)&&(_reservedQSParams.hasOwnProperty(i)?delete qsParams[i]:(extended=extended||{})[i]=qsParams[i]);null!==extended&&(lrsCfg.extended=extended),lrsCfg.allowFail=!1,this.addRecordStore(lrsCfg)}},addRecordStore:function(cfg){var lrs;this.log("addRecordStore"),lrs=cfg instanceof TinCan.LRS?cfg:new TinCan.LRS(cfg),this.recordStores.push(lrs)},prepareStatement:function(stmt){return this.log("prepareStatement"),stmt instanceof TinCan.Statement||(stmt=new TinCan.Statement(stmt)),null===stmt.actor&&null!==this.actor&&(stmt.actor=this.actor),null===stmt.target&&null!==this.activity&&(stmt.target=this.activity),null!==this.context&&(null===stmt.context?stmt.context=this.context:(null===stmt.context.registration&&(stmt.context.registration=this.context.registration),null===stmt.context.platform&&(stmt.context.platform=this.context.platform),null!==this.context.contextActivities&&(null===stmt.context.contextActivities?stmt.context.contextActivities=this.context.contextActivities:(null!==this.context.contextActivities.grouping&&null===stmt.context.contextActivities.grouping&&(stmt.context.contextActivities.grouping=this.context.contextActivities.grouping),null!==this.context.contextActivities.parent&&null===stmt.context.contextActivities.parent&&(stmt.context.contextActivities.parent=this.context.contextActivities.parent),null!==this.context.contextActivities.other&&null===stmt.context.contextActivities.other&&(stmt.context.contextActivities.other=this.context.contextActivities.other))))),stmt},sendStatement:function(stmt,callback){this.log("sendStatement");var self=this,lrs,statement=this.prepareStatement(stmt),rsCount=this.recordStores.length,i,results=[],callbackWrapper,callbackResults=[];if(rsCount>0)for("function"==typeof callback&&(callbackWrapper=function(err,xhr){var args;self.log("sendStatement - callbackWrapper: "+rsCount),rsCount>1?(rsCount-=1,callbackResults.push({err:err,xhr:xhr})):1===rsCount?(callbackResults.push({err:err,xhr:xhr}),args=[callbackResults,statement],callback.apply(this,args)):self.log("sendStatement - unexpected record store count: "+rsCount)}),i=0;i<rsCount;i+=1)lrs=this.recordStores[i],results.push(lrs.saveStatement(statement,{callback:callbackWrapper}));else this.log("[warning] sendStatement: No LRSs added yet (statement not sent)"),"function"==typeof callback&&callback.apply(this,[null,statement]);return{statement:statement,results:results}},getStatement:function(stmtId,callback,cfg){var lrs;if(this.log("getStatement"),(cfg=cfg||{}).params=cfg.params||{},this.recordStores.length>0)return(lrs=this.recordStores[0]).retrieveStatement(stmtId,{callback:callback,params:cfg.params});this.log("[warning] getStatement: No LRSs added yet (statement not retrieved)")},voidStatement:function(stmt,callback,options){this.log("voidStatement");var self=this,lrs,actor,voidingStatement,rsCount=this.recordStores.length,i,results=[],callbackWrapper,callbackResults=[];if(stmt instanceof TinCan.Statement&&(stmt=stmt.id),void 0!==options.actor?actor=options.actor:null!==this.actor&&(actor=this.actor),voidingStatement=new TinCan.Statement({actor:actor,verb:{id:"http://adlnet.gov/expapi/verbs/voided"},target:{objectType:"StatementRef",id:stmt}}),rsCount>0)for("function"==typeof callback&&(callbackWrapper=function(err,xhr){var args;self.log("voidStatement - callbackWrapper: "+rsCount),rsCount>1?(rsCount-=1,callbackResults.push({err:err,xhr:xhr})):1===rsCount?(callbackResults.push({err:err,xhr:xhr}),args=[callbackResults,voidingStatement],callback.apply(this,args)):self.log("voidStatement - unexpected record store count: "+rsCount)}),i=0;i<rsCount;i+=1)lrs=this.recordStores[i],results.push(lrs.saveStatement(voidingStatement,{callback:callbackWrapper}));else this.log("[warning] voidStatement: No LRSs added yet (statement not sent)"),"function"==typeof callback&&callback.apply(this,[null,voidingStatement]);return{statement:voidingStatement,results:results}},getVoidedStatement:function(stmtId,callback){var lrs;if(this.log("getVoidedStatement"),this.recordStores.length>0)return(lrs=this.recordStores[0]).retrieveVoidedStatement(stmtId,{callback:callback});this.log("[warning] getVoidedStatement: No LRSs added yet (statement not retrieved)")},sendStatements:function(stmts,callback){this.log("sendStatements");var self=this,lrs,statements=[],rsCount=this.recordStores.length,i,results=[],callbackWrapper,callbackResults=[];if(0===stmts.length)"function"==typeof callback&&callback.apply(this,[null,statements]);else{for(i=0;i<stmts.length;i+=1)statements.push(this.prepareStatement(stmts[i]));if(rsCount>0)for("function"==typeof callback&&(callbackWrapper=function(err,xhr){var args;self.log("sendStatements - callbackWrapper: "+rsCount),rsCount>1?(rsCount-=1,callbackResults.push({err:err,xhr:xhr})):1===rsCount?(callbackResults.push({err:err,xhr:xhr}),args=[callbackResults,statements],callback.apply(this,args)):self.log("sendStatements - unexpected record store count: "+rsCount)}),i=0;i<rsCount;i+=1)lrs=this.recordStores[i],results.push(lrs.saveStatements(statements,{callback:callbackWrapper}));else this.log("[warning] sendStatements: No LRSs added yet (statements not sent)"),"function"==typeof callback&&callback.apply(this,[null,statements])}return{statements:statements,results:results}},getStatements:function(cfg){this.log("getStatements");var queryCfg={},lrs,params;if(this.recordStores.length>0)return lrs=this.recordStores[0],params=(cfg=cfg||{}).params||{},cfg.sendActor&&null!==this.actor&&("0.9"===lrs.version||"0.95"===lrs.version?params.actor=this.actor:params.agent=this.actor),cfg.sendActivity&&null!==this.activity&&("0.9"===lrs.version||"0.95"===lrs.version?params.target=this.activity:params.activity=this.activity),void 0===params.registration&&null!==this.registration&&(params.registration=this.registration),queryCfg={params:params},void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),lrs.queryStatements(queryCfg);this.log("[warning] getStatements: No LRSs added yet (statements not read)")},getState:function(key,cfg){var queryCfg,lrs;if(this.log("getState"),this.recordStores.length>0)return lrs=this.recordStores[0],queryCfg={agent:void 0!==(cfg=cfg||{}).agent?cfg.agent:this.actor,activity:void 0!==cfg.activity?cfg.activity:this.activity},void 0!==cfg.registration?queryCfg.registration=cfg.registration:null!==this.registration&&(queryCfg.registration=this.registration),void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),lrs.retrieveState(key,queryCfg);this.log("[warning] getState: No LRSs added yet (state not retrieved)")},setState:function(key,val,cfg){var queryCfg,lrs;if(this.log("setState"),this.recordStores.length>0)return lrs=this.recordStores[0],queryCfg={agent:void 0!==(cfg=cfg||{}).agent?cfg.agent:this.actor,activity:void 0!==cfg.activity?cfg.activity:this.activity},void 0!==cfg.registration?queryCfg.registration=cfg.registration:null!==this.registration&&(queryCfg.registration=this.registration),void 0!==cfg.lastSHA1&&(queryCfg.lastSHA1=cfg.lastSHA1),void 0!==cfg.contentType&&(queryCfg.contentType=cfg.contentType,void 0!==cfg.overwriteJSON&&!cfg.overwriteJSON&&TinCan.Utils.isApplicationJSON(cfg.contentType)&&(queryCfg.method="POST")),void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),lrs.saveState(key,val,queryCfg);this.log("[warning] setState: No LRSs added yet (state not saved)")},deleteState:function(key,cfg){var queryCfg,lrs;if(this.log("deleteState"),this.recordStores.length>0)return lrs=this.recordStores[0],queryCfg={agent:void 0!==(cfg=cfg||{}).agent?cfg.agent:this.actor,activity:void 0!==cfg.activity?cfg.activity:this.activity},void 0!==cfg.registration?queryCfg.registration=cfg.registration:null!==this.registration&&(queryCfg.registration=this.registration),void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),lrs.dropState(key,queryCfg);this.log("[warning] deleteState: No LRSs added yet (state not deleted)")},getActivityProfile:function(key,cfg){var queryCfg,lrs;if(this.log("getActivityProfile"),this.recordStores.length>0)return lrs=this.recordStores[0],queryCfg={activity:void 0!==(cfg=cfg||{}).activity?cfg.activity:this.activity},void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),lrs.retrieveActivityProfile(key,queryCfg);this.log("[warning] getActivityProfile: No LRSs added yet (activity profile not retrieved)")},setActivityProfile:function(key,val,cfg){var queryCfg,lrs;if(this.log("setActivityProfile"),this.recordStores.length>0)return lrs=this.recordStores[0],queryCfg={activity:void 0!==(cfg=cfg||{}).activity?cfg.activity:this.activity},void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),void 0!==cfg.lastSHA1&&(queryCfg.lastSHA1=cfg.lastSHA1),void 0!==cfg.contentType&&(queryCfg.contentType=cfg.contentType,void 0!==cfg.overwriteJSON&&!cfg.overwriteJSON&&TinCan.Utils.isApplicationJSON(cfg.contentType)&&(queryCfg.method="POST")),lrs.saveActivityProfile(key,val,queryCfg);this.log("[warning] setActivityProfile: No LRSs added yet (activity profile not saved)")},deleteActivityProfile:function(key,cfg){var queryCfg,lrs;if(this.log("deleteActivityProfile"),this.recordStores.length>0)return lrs=this.recordStores[0],queryCfg={activity:void 0!==(cfg=cfg||{}).activity?cfg.activity:this.activity},void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),lrs.dropActivityProfile(key,queryCfg);this.log("[warning] deleteActivityProfile: No LRSs added yet (activity profile not deleted)")},getAgentProfile:function(key,cfg){var queryCfg,lrs;if(this.log("getAgentProfile"),this.recordStores.length>0)return lrs=this.recordStores[0],queryCfg={agent:void 0!==(cfg=cfg||{}).agent?cfg.agent:this.actor},void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),lrs.retrieveAgentProfile(key,queryCfg);this.log("[warning] getAgentProfile: No LRSs added yet (agent profile not retrieved)")},setAgentProfile:function(key,val,cfg){var queryCfg,lrs;if(this.log("setAgentProfile"),this.recordStores.length>0)return lrs=this.recordStores[0],queryCfg={agent:void 0!==(cfg=cfg||{}).agent?cfg.agent:this.actor},void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),void 0!==cfg.lastSHA1&&(queryCfg.lastSHA1=cfg.lastSHA1),void 0!==cfg.contentType&&(queryCfg.contentType=cfg.contentType,void 0!==cfg.overwriteJSON&&!cfg.overwriteJSON&&TinCan.Utils.isApplicationJSON(cfg.contentType)&&(queryCfg.method="POST")),lrs.saveAgentProfile(key,val,queryCfg);this.log("[warning] setAgentProfile: No LRSs added yet (agent profile not saved)")},deleteAgentProfile:function(key,cfg){var queryCfg,lrs;if(this.log("deleteAgentProfile"),this.recordStores.length>0)return lrs=this.recordStores[0],queryCfg={agent:void 0!==(cfg=cfg||{}).agent?cfg.agent:this.actor},void 0!==cfg.callback&&(queryCfg.callback=cfg.callback),lrs.dropAgentProfile(key,queryCfg);this.log("[warning] deleteAgentProfile: No LRSs added yet (agent profile not deleted)")}},TinCan.DEBUG=!0,TinCan.enableDebug=function(){TinCan.DEBUG=!0},TinCan.disableDebug=function(){TinCan.DEBUG=!1},TinCan.versions=function(){return["1.0.2","1.0.1","1.0.0","0.95","0.9"]},"object"==typeof module&&(module.exports=TinCan)}(),function(){"use strict";TinCan.Utils={defaultEncoding:"utf8",getUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v;return("x"==c?r:3&r|8).toString(16)})},getISODateString:function(d){function pad(val,n){var padder,tempVal;for(null==val&&(val=0),null==n&&(n=2),padder=Math.pow(10,n-1),tempVal=val.toString();val<padder&&padder>1;)tempVal="0"+tempVal,padder/=10;return tempVal}return d.getUTCFullYear()+"-"+pad(d.getUTCMonth()+1)+"-"+pad(d.getUTCDate())+"T"+pad(d.getUTCHours())+":"+pad(d.getUTCMinutes())+":"+pad(d.getUTCSeconds())+"."+pad(d.getUTCMilliseconds(),3)+"Z"},convertISO8601DurationToMilliseconds:function(ISO8601Duration){var isValueNegative=ISO8601Duration.indexOf("-")>=0,indexOfT=ISO8601Duration.indexOf("T"),indexOfH=ISO8601Duration.indexOf("H"),indexOfM=ISO8601Duration.indexOf("M"),indexOfS=ISO8601Duration.indexOf("S"),hours,minutes,seconds,durationInMilliseconds;if(-1===indexOfT||-1!==indexOfM&&indexOfM<indexOfT||-1!==ISO8601Duration.indexOf("D")||-1!==ISO8601Duration.indexOf("Y"))throw new Error("ISO 8601 timestamps including years, months and/or days are not currently supported");return-1===indexOfH?(indexOfH=indexOfT,hours=0):hours=parseInt(ISO8601Duration.slice(indexOfT+1,indexOfH),10),-1===indexOfM?(indexOfM=indexOfT,minutes=0):minutes=parseInt(ISO8601Duration.slice(indexOfH+1,indexOfM),10),seconds=parseFloat(ISO8601Duration.slice(indexOfM+1,indexOfS)),durationInMilliseconds=parseInt(1e3*(60*(60*hours+minutes)+seconds),10),isNaN(durationInMilliseconds)&&(durationInMilliseconds=0),isValueNegative&&(durationInMilliseconds*=-1),durationInMilliseconds},convertMillisecondsToISO8601Duration:function(inputMilliseconds){var hours,minutes,seconds,i_inputMilliseconds=parseInt(inputMilliseconds,10),i_inputCentiseconds,inputIsNegative="",rtnStr="";return(i_inputCentiseconds=Math.round(i_inputMilliseconds/10))<0&&(inputIsNegative="-",i_inputCentiseconds*=-1),rtnStr=inputIsNegative+"PT",(hours=parseInt(i_inputCentiseconds/36e4,10))>0&&(rtnStr+=hours+"H"),(minutes=parseInt(i_inputCentiseconds%36e4/6e3,10))>0&&(rtnStr+=minutes+"M"),rtnStr+=(seconds=i_inputCentiseconds%36e4%6e3/100)+"S"},getSHA1String:function(str){return CryptoJS.SHA1(str).toString(CryptoJS.enc.Hex)},getSHA256String:function(content){return"[object ArrayBuffer]"===Object.prototype.toString.call(content)&&(content=CryptoJS.lib.WordArray.create(content)),CryptoJS.SHA256(content).toString(CryptoJS.enc.Hex)},getBase64String:function(str){return CryptoJS.enc.Base64.stringify(CryptoJS.enc.Latin1.parse(str))},getLangDictionaryValue:function(prop,lang){var langDict=this[prop],key;if(void 0!==lang&&void 0!==langDict[lang])return langDict[lang];if(void 0!==langDict.und)return langDict.und;if(void 0!==langDict["en-US"])return langDict["en-US"];for(key in langDict)if(langDict.hasOwnProperty(key))return langDict[key];return""},parseURL:function(url,cfg){var isRelative="/"===url.charAt(0),_reURLInformation=["(/[^?#]*)","(\\?[^#]*|)","(#.*|)$"],reURLInformation,match,result,paramMatch,pl=/\+/g,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(pl," "))};if(cfg=cfg||{},isRelative){if(void 0===cfg.allowRelative||!cfg.allowRelative)throw new Error("Refusing to parse relative URL without 'allowRelative' option")}else _reURLInformation.unshift("^(https?:)//","(([^:/?#]*)(?::([0-9]+))?)"),-1===url.indexOf("/",8)&&(url+="/");if(reURLInformation=new RegExp(_reURLInformation.join("")),null===(match=url.match(reURLInformation)))throw new Error("Unable to parse URL regular expression did not match: '"+url+"'");if(isRelative?(result={protocol:null,host:null,hostname:null,port:null,path:null,pathname:match[1],search:match[2],hash:match[3],params:{}}).path=result.pathname:(result={protocol:match[1],host:match[2],hostname:match[3],port:match[4],pathname:match[5],search:match[6],hash:match[7],params:{}}).path=result.protocol+"//"+result.host+result.pathname,""!==result.search)for(;paramMatch=search.exec(result.search.substring(1));)result.params[decode(paramMatch[1])]=decode(paramMatch[2]);return result},getServerRoot:function(absoluteUrl){var urlParts=absoluteUrl.split("/");return urlParts[0]+"//"+urlParts[2]},getContentTypeFromHeader:function(header){return String(header).split(";")[0]},isApplicationJSON:function(header){return 0===TinCan.Utils.getContentTypeFromHeader(header).toLowerCase().indexOf("application/json")},stringToArrayBuffer:function(){TinCan.prototype.log("stringToArrayBuffer not overloaded - no environment loaded?")},stringFromArrayBuffer:function(){TinCan.prototype.log("stringFromArrayBuffer not overloaded - no environment loaded?")}}}(),function(){"use strict";var LRS=TinCan.LRS=function(cfg){this.log("constructor"),this.endpoint=null,this.version=null,this.auth=null,this.allowFail=!0,this.extended=null,this.init(cfg)};LRS.prototype={LOG_SRC:"LRS",log:TinCan.prototype.log,init:function(cfg){this.log("init");var versions=TinCan.versions(),versionMatch=!1,i;if((cfg=cfg||{}).hasOwnProperty("alertOnRequestFailure")&&this.log("'alertOnRequestFailure' is deprecated (alerts have been removed) no need to set it now"),!cfg.hasOwnProperty("endpoint")||null===cfg.endpoint||""===cfg.endpoint)throw this.log("[error] LRS invalid: no endpoint"),{code:3,mesg:"LRS invalid: no endpoint"};if(this.endpoint=String(cfg.endpoint),"/"!==this.endpoint.slice(-1)&&(this.log("adding trailing slash to endpoint"),this.endpoint+="/"),cfg.hasOwnProperty("allowFail")&&(this.allowFail=cfg.allowFail),cfg.hasOwnProperty("auth")?this.auth=cfg.auth:cfg.hasOwnProperty("username")&&cfg.hasOwnProperty("password")&&(this.auth="Basic "+TinCan.Utils.getBase64String(cfg.username+":"+cfg.password)),cfg.hasOwnProperty("extended")&&(this.extended=cfg.extended),this._initByEnvironment(cfg),void 0!==cfg.version){for(this.log("version: "+cfg.version),i=0;i<versions.length;i+=1)if(versions[i]===cfg.version){versionMatch=!0;break}if(!versionMatch)throw this.log("[error] LRS invalid: version not supported ("+cfg.version+")"),{code:5,mesg:"LRS invalid: version not supported ("+cfg.version+")"};this.version=cfg.version}else this.version=versions[0]},_getBoundary:function(){return TinCan.Utils.getUUID().replace(/-/g,"")},_initByEnvironment:function(){this.log("_initByEnvironment not overloaded - no environment loaded?")},_makeRequest:function(){this.log("_makeRequest not overloaded - no environment loaded?")},_getMultipartRequestData:function(){this.log("_getMultipartRequestData not overloaded - no environment loaded?")},_IEModeConversion:function(){this.log("_IEModeConversion not overloaded - browser environment not loaded.")},_processGetStatementResult:function(xhr,params){var boundary,parsedResponse,statement,attachmentMap={},i;if(!params.attachments)return TinCan.Statement.fromJSON(xhr.responseText);for(boundary=xhr.getResponseHeader("Content-Type").split("boundary=")[1],parsedResponse=this._parseMultipart(boundary,xhr.response),statement=JSON.parse(parsedResponse[0].body),i=1;i<parsedResponse.length;i+=1)attachmentMap[parsedResponse[i].headers["X-Experience-API-Hash"]]=parsedResponse[i].body;return this._assignAttachmentContent([statement],attachmentMap),new TinCan.Statement(statement)},sendRequest:function(cfg){this.log("sendRequest");var fullUrl=this.endpoint+cfg.url,headers={},prop;if(0===cfg.url.indexOf("http")&&(fullUrl=cfg.url),null!==this.extended)for(prop in cfg.params=cfg.params||{},this.extended)this.extended.hasOwnProperty(prop)&&(cfg.params.hasOwnProperty(prop)||null!==this.extended[prop]&&(cfg.params[prop]=this.extended[prop]));for(prop in headers.Authorization=this.auth,"0.9"!==this.version&&(headers["X-Experience-API-Version"]=this.version),cfg.headers)cfg.headers.hasOwnProperty(prop)&&(headers[prop]=cfg.headers[prop]);return this._makeRequest(fullUrl,headers,cfg)},about:function(cfg){var requestCfg,requestResult,callbackWrapper;if(this.log("about"),requestCfg={url:"about",method:"GET",params:{}},void 0!==(cfg=cfg||{}).callback&&(callbackWrapper=function(err,xhr){var result=xhr;null===err&&(result=TinCan.About.fromJSON(xhr.responseText)),cfg.callback(err,result)},requestCfg.callback=callbackWrapper),requestResult=this.sendRequest(requestCfg),!callbackWrapper)return null===requestResult.err&&(requestResult.xhr=TinCan.About.fromJSON(requestResult.xhr.responseText)),requestResult},saveStatement:function(stmt,cfg){this.log("saveStatement");var requestCfg={url:"statements",headers:{}},versionedStatement,requestAttachments=[],boundary,i;cfg=cfg||{};try{versionedStatement=stmt.asVersion(this.version)}catch(ex){return this.allowFail?(this.log("[warning] statement could not be serialized in version ("+this.version+"): "+ex),void 0!==cfg.callback?void cfg.callback(null,null):{err:null,xhr:null}):(this.log("[error] statement could not be serialized in version ("+this.version+"): "+ex),void 0!==cfg.callback?void cfg.callback(ex,null):{err:ex,xhr:null})}if(versionedStatement.hasOwnProperty("attachments")&&stmt.hasAttachmentWithContent()){for(boundary=this._getBoundary(),requestCfg.headers["Content-Type"]="multipart/mixed; boundary="+boundary,i=0;i<stmt.attachments.length;i+=1)null!==stmt.attachments[i].content&&requestAttachments.push(stmt.attachments[i]);try{requestCfg.data=this._getMultipartRequestData(boundary,versionedStatement,requestAttachments)}catch(ex){return this.allowFail?(this.log("[warning] multipart request data could not be created (attachments probably not supported): "+ex),void 0!==cfg.callback?void cfg.callback(null,null):{err:null,xhr:null}):(this.log("[error] multipart request data could not be created (attachments probably not supported): "+ex),void 0!==cfg.callback?void cfg.callback(ex,null):{err:ex,xhr:null})}}else requestCfg.headers["Content-Type"]="application/json",requestCfg.data=JSON.stringify(versionedStatement);return null!==stmt.id?(requestCfg.method="PUT",requestCfg.params={statementId:stmt.id}):requestCfg.method="POST",void 0!==cfg.callback&&(requestCfg.callback=cfg.callback),this.sendRequest(requestCfg)},retrieveStatement:function(stmtId,cfg){this.log("retrieveStatement");var requestCfg,requestResult,callbackWrapper,lrs=this;return(cfg=cfg||{}).params=cfg.params||{},requestCfg={url:"statements",method:"GET",params:{statementId:stmtId}},cfg.params.attachments&&(requestCfg.params.attachments=!0,requestCfg.expectMultipart=!0),void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;null===err&&(result=lrs._processGetStatementResult(xhr,cfg.params)),cfg.callback(err,result)},requestCfg.callback=callbackWrapper),requestResult=this.sendRequest(requestCfg),callbackWrapper||(requestResult.statement=null,null===requestResult.err&&(requestResult.statement=lrs._processGetStatementResult(requestResult.xhr,cfg.params))),requestResult},retrieveVoidedStatement:function(stmtId,cfg){this.log("retrieveVoidedStatement");var requestCfg,requestResult,callbackWrapper,lrs=this;return(cfg=cfg||{}).params=cfg.params||{},requestCfg={url:"statements",method:"GET",params:{}},"0.9"===this.version||"0.95"===this.version?requestCfg.params.statementId=stmtId:(requestCfg.params.voidedStatementId=stmtId,cfg.params.attachments&&(requestCfg.params.attachments=!0,requestCfg.expectMultipart=!0)),void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;null===err&&(result=lrs._processGetStatementResult(xhr,cfg.params)),cfg.callback(err,result)},requestCfg.callback=callbackWrapper),requestResult=this.sendRequest(requestCfg),callbackWrapper||(requestResult.statement=null,null===requestResult.err&&(requestResult.statement=lrs._processGetStatementResult(requestResult.xhr,cfg.params))),requestResult},saveStatements:function(stmts,cfg){this.log("saveStatements");var requestCfg={url:"statements",method:"POST",headers:{}},versionedStatement,versionedStatements=[],requestAttachments=[],boundary,i,j;if(cfg=cfg||{},0===stmts.length)return void 0!==cfg.callback?void cfg.callback(new Error("no statements"),null):{err:new Error("no statements"),xhr:null};for(i=0;i<stmts.length;i+=1){try{versionedStatement=stmts[i].asVersion(this.version)}catch(ex){return this.allowFail?(this.log("[warning] statement could not be serialized in version ("+this.version+"): "+ex),void 0!==cfg.callback?void cfg.callback(null,null):{err:null,xhr:null}):(this.log("[error] statement could not be serialized in version ("+this.version+"): "+ex),void 0!==cfg.callback?void cfg.callback(ex,null):{err:ex,xhr:null})}if(stmts[i].hasAttachmentWithContent())for(j=0;j<stmts[i].attachments.length;j+=1)null!==stmts[i].attachments[j].content&&requestAttachments.push(stmts[i].attachments[j]);versionedStatements.push(versionedStatement)}if(0!==requestAttachments.length){boundary=this._getBoundary(),requestCfg.headers["Content-Type"]="multipart/mixed; boundary="+boundary;try{requestCfg.data=this._getMultipartRequestData(boundary,versionedStatements,requestAttachments)}catch(ex){return this.allowFail?(this.log("[warning] multipart request data could not be created (attachments probably not supported): "+ex),void 0!==cfg.callback?void cfg.callback(null,null):{err:null,xhr:null}):(this.log("[error] multipart request data could not be created (attachments probably not supported): "+ex),void 0!==cfg.callback?void cfg.callback(ex,null):{err:ex,xhr:null})}}else requestCfg.headers["Content-Type"]="application/json",requestCfg.data=JSON.stringify(versionedStatements);return void 0!==cfg.callback&&(requestCfg.callback=cfg.callback),this.sendRequest(requestCfg)},queryStatements:function(cfg){this.log("queryStatements");var requestCfg,requestResult,callbackWrapper,lrs=this;(cfg=cfg||{}).params=cfg.params||{};try{requestCfg=this._queryStatementsRequestCfg(cfg),cfg.params.attachments&&(requestCfg.expectMultipart=!0)}catch(ex){return this.log("[error] Query statements failed - "+ex),void 0!==cfg.callback&&cfg.callback(ex,{}),{err:ex,statementsResult:null}}return void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr,parsedResponse,boundary,statements,attachmentMap={},i;if(null===err)if(cfg.params.attachments){for(boundary=xhr.getResponseHeader("Content-Type").split("boundary=")[1],parsedResponse=lrs._parseMultipart(boundary,xhr.response),statements=JSON.parse(parsedResponse[0].body),i=1;i<parsedResponse.length;i+=1)attachmentMap[parsedResponse[i].headers["X-Experience-API-Hash"]]=parsedResponse[i].body;for(lrs._assignAttachmentContent(statements.statements,attachmentMap),result=new TinCan.StatementsResult({statements:statements.statements}),i=0;i<result.statements.length;i+=1)result.statements[i]instanceof TinCan.Statement||(result.statements[i]=new TinCan.Statement(result.statements[i]))}else result=TinCan.StatementsResult.fromJSON(xhr.responseText);cfg.callback(err,result)},requestCfg.callback=callbackWrapper),(requestResult=this.sendRequest(requestCfg)).config=requestCfg,callbackWrapper||(requestResult.statementsResult=null,null===requestResult.err&&(requestResult.statementsResult=TinCan.StatementsResult.fromJSON(requestResult.xhr.responseText))),requestResult},_queryStatementsRequestCfg:function(cfg){this.log("_queryStatementsRequestCfg");var params={},returnCfg={url:"statements",method:"GET",params:params},jsonProps=["agent","actor","object","instructor"],idProps=["verb","activity"],valProps=["registration","context","since","until","limit","authoritative","sparse","ascending","related_activities","related_agents","format","attachments"],i,prop,universal={verb:!0,registration:!0,since:!0,until:!0,limit:!0,ascending:!0},compatibility={.9:{supported:{actor:!0,instructor:!0,target:!0,object:!0,context:!0,authoritative:!0,sparse:!0}},"1.0.0":{supported:{agent:!0,activity:!0,related_activities:!0,related_agents:!0,format:!0,attachments:!0}}};for(prop in compatibility[.95]=compatibility[.9],compatibility["1.0.1"]=compatibility["1.0.0"],compatibility["1.0.2"]=compatibility["1.0.0"],cfg.params.hasOwnProperty("target")&&(cfg.params.object=cfg.params.target),cfg.params)if(cfg.params.hasOwnProperty(prop)&&void 0===universal[prop]&&void 0===compatibility[this.version].supported[prop])throw"Unrecognized query parameter configured: "+prop;for(i=0;i<jsonProps.length;i+=1)void 0!==cfg.params[jsonProps[i]]&&(params[jsonProps[i]]=JSON.stringify(cfg.params[jsonProps[i]].asVersion(this.version)));for(i=0;i<idProps.length;i+=1)void 0!==cfg.params[idProps[i]]&&(void 0===cfg.params[idProps[i]].id?params[idProps[i]]=cfg.params[idProps[i]]:params[idProps[i]]=cfg.params[idProps[i]].id);for(i=0;i<valProps.length;i+=1)void 0!==cfg.params[valProps[i]]&&null!==cfg.params[valProps[i]]&&(params[valProps[i]]=cfg.params[valProps[i]]);return returnCfg},_assignAttachmentContent:function(stmts,attachmentMap){var i,j;for(i=0;i<stmts.length;i+=1)if(stmts[i].hasOwnProperty("attachments")&&null!==stmts[i].attachments)for(j=0;j<stmts[i].attachments.length;j+=1)attachmentMap.hasOwnProperty(stmts[i].attachments[j].sha2)&&(stmts[i].attachments[j].content=attachmentMap[stmts[i].attachments[j].sha2])},_parseMultipart:function(boundary,response){var __boundary="--"+boundary,byteArray,bodyEncodedInString,fullBodyEnd,sliceStart,sliceEnd,headerStart,headerEnd,bodyStart,bodyEnd,headers,body,parts=[],CRLF=2;for(byteArray=new Uint8Array(response),fullBodyEnd=(bodyEncodedInString=this.__uint8ToString(byteArray)).indexOf(__boundary+"--"),sliceStart=bodyEncodedInString.indexOf(__boundary);-1!==sliceStart;)sliceEnd=bodyEncodedInString.indexOf(__boundary,sliceStart+__boundary.length),headerStart=sliceStart+__boundary.length+2,bodyStart=(headerEnd=bodyEncodedInString.indexOf("\r\n\r\n",sliceStart))+2+2,bodyEnd=sliceEnd-2,headers=this._parseHeaders(this.__uint8ToString(new Uint8Array(response.slice(headerStart,headerEnd)))),body=response.slice(bodyStart,bodyEnd),0===parts.length&&(body=TinCan.Utils.stringFromArrayBuffer(body)),parts.push({headers:headers,body:body}),sliceStart=sliceEnd===fullBodyEnd?-1:sliceEnd;return parts},__uint8ToString:function(byteArray){var result="",len=byteArray.byteLength,i;for(i=0;i<len;i+=1)result+=String.fromCharCode(byteArray[i]);return result},_parseHeaders:function(rawHeaders){var headers={},headerList,key,h,i;for(headerList=rawHeaders.split("\n"),i=0;i<headerList.length;i+=1)null!==(h=headerList[i].split(":",2))[1]?(headers[h[0]]=h[1].replace(/^\s+|\s+$/g,""),key=h[0]):"\t"===h[0].substring(0,1)&&(headers[h[0]]=h[1].replace(/^\s+|\s+$/g,""));return headers},moreStatements:function(cfg){var requestCfg,requestResult,callbackWrapper,parsedURL,serverRoot;return this.log("moreStatements: "+cfg.url),cfg=cfg||{},parsedURL=TinCan.Utils.parseURL(cfg.url,{allowRelative:!0}),serverRoot=TinCan.Utils.getServerRoot(this.endpoint),0===parsedURL.path.indexOf("/statements")&&(parsedURL.path=this.endpoint.replace(serverRoot,"")+parsedURL.path,this.log("converting non-standard more URL to "+parsedURL.path)),0!==parsedURL.path.indexOf("/")&&(parsedURL.path="/"+parsedURL.path),requestCfg={method:"GET",url:serverRoot+parsedURL.path,params:parsedURL.params},void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;null===err&&(result=TinCan.StatementsResult.fromJSON(xhr.responseText)),cfg.callback(err,result)},requestCfg.callback=callbackWrapper),(requestResult=this.sendRequest(requestCfg)).config=requestCfg,callbackWrapper||(requestResult.statementsResult=null,null===requestResult.err&&(requestResult.statementsResult=TinCan.StatementsResult.fromJSON(requestResult.xhr.responseText))),requestResult},retrieveState:function(key,cfg){this.log("retrieveState");var requestParams={},requestCfg={},requestResult,callbackWrapper,requestHeaders,self=this;if(requestHeaders=cfg.requestHeaders||{},requestParams={stateId:key,activityId:cfg.activity.id},"0.9"===this.version?requestParams.actor=JSON.stringify(cfg.agent.asVersion(this.version)):requestParams.agent=JSON.stringify(cfg.agent.asVersion(this.version)),void 0!==cfg.registration&&null!==cfg.registration&&("0.9"===this.version?requestParams.registrationId=cfg.registration:requestParams.registration=cfg.registration),requestCfg={url:"activities/state",method:"GET",params:requestParams,ignore404:!0,headers:requestHeaders},void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;if(null===err)if(404===xhr.status)result=null;else if(result=new TinCan.State({id:key,contents:xhr.responseText}),void 0!==xhr.getResponseHeader&&null!==xhr.getResponseHeader("ETag")&&""!==xhr.getResponseHeader("ETag")?result.etag=xhr.getResponseHeader("ETag"):result.etag='"'+TinCan.Utils.getSHA1String(xhr.responseText)+'"',void 0!==xhr.contentType?result.contentType=xhr.contentType:void 0!==xhr.getResponseHeader&&null!==xhr.getResponseHeader("Content-Type")&&""!==xhr.getResponseHeader("Content-Type")&&(result.contentType=xhr.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(result.contentType))try{result.contents=JSON.parse(result.contents)}catch(ex){self.log("retrieveState - failed to deserialize JSON: "+ex)}cfg.callback(err,result)},requestCfg.callback=callbackWrapper),requestResult=this.sendRequest(requestCfg),!callbackWrapper&&(requestResult.state=null,null===requestResult.err&&404!==requestResult.xhr.status&&(requestResult.state=new TinCan.State({id:key,contents:requestResult.xhr.responseText}),void 0!==requestResult.xhr.getResponseHeader&&null!==requestResult.xhr.getResponseHeader("ETag")&&""!==requestResult.xhr.getResponseHeader("ETag")?requestResult.state.etag=requestResult.xhr.getResponseHeader("ETag"):requestResult.state.etag='"'+TinCan.Utils.getSHA1String(requestResult.xhr.responseText)+'"',void 0!==requestResult.xhr.contentType?requestResult.state.contentType=requestResult.xhr.contentType:void 0!==requestResult.xhr.getResponseHeader&&null!==requestResult.xhr.getResponseHeader("Content-Type")&&""!==requestResult.xhr.getResponseHeader("Content-Type")&&(requestResult.state.contentType=requestResult.xhr.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(requestResult.state.contentType))))try{requestResult.state.contents=JSON.parse(requestResult.state.contents)}catch(ex){this.log("retrieveState - failed to deserialize JSON: "+ex)}return requestResult},retrieveStateIds:function(cfg){this.log("retrieveStateIds");var requestParams={},requestCfg,requestHeaders,requestResult,callbackWrapper;if(requestHeaders=(cfg=cfg||{}).requestHeaders||{},requestParams.activityId=cfg.activity.id,"0.9"===this.version?requestParams.actor=JSON.stringify(cfg.agent.asVersion(this.version)):requestParams.agent=JSON.stringify(cfg.agent.asVersion(this.version)),void 0!==cfg.registration&&null!==cfg.registration&&("0.9"===this.version?requestParams.registrationId=cfg.registration:requestParams.registration=cfg.registration),requestCfg={url:"activities/state",method:"GET",params:requestParams,headers:requestHeaders,ignore404:!0},void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;if(null===err){if(404===xhr.status)result=[];else try{result=JSON.parse(xhr.responseText)}catch(ex){err="Response JSON parse error: "+ex}cfg.callback(err,result)}else cfg.callback(err,result)},requestCfg.callback=callbackWrapper),void 0!==cfg.since&&(requestCfg.params.since=cfg.since),requestResult=this.sendRequest(requestCfg),!callbackWrapper){if(requestResult.profileIds=null,null!==requestResult.err)return requestResult;if(404===requestResult.xhr.status)requestResult.profileIds=[];else try{requestResult.profileIds=JSON.parse(requestResult.xhr.responseText)}catch(ex){requestResult.err="retrieveStateIds - JSON parse error: "+ex}}return requestResult},saveState:function(key,val,cfg){var requestParams,requestCfg,requestHeaders;return this.log("saveState"),requestHeaders=cfg.requestHeaders||{},void 0===cfg.contentType&&(cfg.contentType="application/octet-stream"),requestHeaders["Content-Type"]=cfg.contentType,"object"==typeof val&&TinCan.Utils.isApplicationJSON(cfg.contentType)&&(val=JSON.stringify(val)),void 0!==cfg.method&&"POST"===cfg.method||(cfg.method="PUT"),requestParams={stateId:key,activityId:cfg.activity.id},"0.9"===this.version?requestParams.actor=JSON.stringify(cfg.agent.asVersion(this.version)):requestParams.agent=JSON.stringify(cfg.agent.asVersion(this.version)),void 0!==cfg.registration&&null!==cfg.registration&&("0.9"===this.version?requestParams.registrationId=cfg.registration:requestParams.registration=cfg.registration),requestCfg={url:"activities/state",method:cfg.method,params:requestParams,data:val,headers:requestHeaders},void 0!==cfg.callback&&(requestCfg.callback=cfg.callback),void 0!==cfg.lastSHA1&&null!==cfg.lastSHA1&&(requestCfg.headers["If-Match"]=cfg.lastSHA1),this.sendRequest(requestCfg)},dropState:function(key,cfg){var requestParams,requestCfg,requestHeaders;return this.log("dropState"),requestHeaders=cfg.requestHeaders||{},requestParams={activityId:cfg.activity.id},"0.9"===this.version?requestParams.actor=JSON.stringify(cfg.agent.asVersion(this.version)):requestParams.agent=JSON.stringify(cfg.agent.asVersion(this.version)),null!==key&&(requestParams.stateId=key),void 0!==cfg.registration&&null!==cfg.registration&&("0.9"===this.version?requestParams.registrationId=cfg.registration:requestParams.registration=cfg.registration),requestCfg={url:"activities/state",method:"DELETE",params:requestParams,headers:requestHeaders},void 0!==cfg.callback&&(requestCfg.callback=cfg.callback),this.sendRequest(requestCfg)},retrieveActivity:function(activityId,cfg){this.log("retrieveActivity");var requestCfg={},requestResult,callbackWrapper,requestHeaders;return requestHeaders=cfg.requestHeaders||{},requestCfg={url:"activities",method:"GET",params:{activityId:activityId},ignore404:!0,headers:requestHeaders},void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;null===err&&(result=404===xhr.status?new TinCan.Activity({id:activityId}):TinCan.Activity.fromJSON(xhr.responseText)),cfg.callback(err,result)},requestCfg.callback=callbackWrapper),requestResult=this.sendRequest(requestCfg),callbackWrapper||(requestResult.activity=null,null===requestResult.err&&(404===requestResult.xhr.status?requestResult.activity=new TinCan.Activity({id:activityId}):requestResult.activity=TinCan.Activity.fromJSON(requestResult.xhr.responseText))),requestResult},retrieveActivityProfile:function(key,cfg){this.log("retrieveActivityProfile");var requestCfg={},requestResult,callbackWrapper,requestHeaders,self=this;if(requestHeaders=cfg.requestHeaders||{},requestCfg={url:"activities/profile",method:"GET",params:{profileId:key,activityId:cfg.activity.id},ignore404:!0,headers:requestHeaders},void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;if(null===err)if(404===xhr.status)result=null;else if(result=new TinCan.ActivityProfile({id:key,activity:cfg.activity,contents:xhr.responseText}),void 0!==xhr.getResponseHeader&&null!==xhr.getResponseHeader("ETag")&&""!==xhr.getResponseHeader("ETag")?result.etag=xhr.getResponseHeader("ETag"):result.etag='"'+TinCan.Utils.getSHA1String(xhr.responseText)+'"',void 0!==xhr.contentType?result.contentType=xhr.contentType:void 0!==xhr.getResponseHeader&&null!==xhr.getResponseHeader("Content-Type")&&""!==xhr.getResponseHeader("Content-Type")&&(result.contentType=xhr.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(result.contentType))try{result.contents=JSON.parse(result.contents)}catch(ex){self.log("retrieveActivityProfile - failed to deserialize JSON: "+ex)}cfg.callback(err,result)},requestCfg.callback=callbackWrapper),requestResult=this.sendRequest(requestCfg),!callbackWrapper&&(requestResult.profile=null,null===requestResult.err&&404!==requestResult.xhr.status&&(requestResult.profile=new TinCan.ActivityProfile({id:key,activity:cfg.activity,contents:requestResult.xhr.responseText}),void 0!==requestResult.xhr.getResponseHeader&&null!==requestResult.xhr.getResponseHeader("ETag")&&""!==requestResult.xhr.getResponseHeader("ETag")?requestResult.profile.etag=requestResult.xhr.getResponseHeader("ETag"):requestResult.profile.etag='"'+TinCan.Utils.getSHA1String(requestResult.xhr.responseText)+'"',void 0!==requestResult.xhr.contentType?requestResult.profile.contentType=requestResult.xhr.contentType:void 0!==requestResult.xhr.getResponseHeader&&null!==requestResult.xhr.getResponseHeader("Content-Type")&&""!==requestResult.xhr.getResponseHeader("Content-Type")&&(requestResult.profile.contentType=requestResult.xhr.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(requestResult.profile.contentType))))try{requestResult.profile.contents=JSON.parse(requestResult.profile.contents)}catch(ex){this.log("retrieveActivityProfile - failed to deserialize JSON: "+ex)}return requestResult},retrieveActivityProfileIds:function(cfg){var requestCfg,requestHeaders,requestResult,callbackWrapper;if(this.log("retrieveActivityProfileIds"),requestHeaders=(cfg=cfg||{}).requestHeaders||{},requestCfg={url:"activities/profile",method:"GET",params:{activityId:cfg.activity.id},headers:requestHeaders,ignore404:!0},void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;if(null===err){if(404===xhr.status)result=[];else try{result=JSON.parse(xhr.responseText)}catch(ex){err="Response JSON parse error: "+ex}cfg.callback(err,result)}else cfg.callback(err,result)},requestCfg.callback=callbackWrapper),void 0!==cfg.since&&(requestCfg.params.since=cfg.since),requestResult=this.sendRequest(requestCfg),!callbackWrapper){if(requestResult.profileIds=null,null!==requestResult.err)return requestResult;if(404===requestResult.xhr.status)requestResult.profileIds=[];else try{requestResult.profileIds=JSON.parse(requestResult.xhr.responseText)}catch(ex){requestResult.err="retrieveActivityProfileIds - JSON parse error: "+ex}}return requestResult},saveActivityProfile:function(key,val,cfg){var requestCfg,requestHeaders;return this.log("saveActivityProfile"),requestHeaders=cfg.requestHeaders||{},void 0===cfg.contentType&&(cfg.contentType="application/octet-stream"),requestHeaders["Content-Type"]=cfg.contentType,void 0!==cfg.method&&"POST"===cfg.method||(cfg.method="PUT"),"object"==typeof val&&TinCan.Utils.isApplicationJSON(cfg.contentType)&&(val=JSON.stringify(val)),requestCfg={url:"activities/profile",method:cfg.method,params:{profileId:key,activityId:cfg.activity.id},data:val,headers:requestHeaders},void 0!==cfg.callback&&(requestCfg.callback=cfg.callback),void 0!==cfg.lastSHA1&&null!==cfg.lastSHA1?requestCfg.headers["If-Match"]=cfg.lastSHA1:requestCfg.headers["If-None-Match"]="*",this.sendRequest(requestCfg)},dropActivityProfile:function(key,cfg){var requestParams,requestCfg,requestHeaders;return this.log("dropActivityProfile"),requestHeaders=cfg.requestHeaders||{},requestCfg={url:"activities/profile",method:"DELETE",params:requestParams={profileId:key,activityId:cfg.activity.id},headers:requestHeaders},void 0!==cfg.callback&&(requestCfg.callback=cfg.callback),this.sendRequest(requestCfg)},retrieveAgentProfile:function(key,cfg){this.log("retrieveAgentProfile");var requestCfg={},requestResult,callbackWrapper,requestHeaders,self=this;if(requestHeaders=cfg.requestHeaders||{},requestCfg={method:"GET",params:{profileId:key},ignore404:!0,headers:requestHeaders},"0.9"===this.version?(requestCfg.url="actors/profile",requestCfg.params.actor=JSON.stringify(cfg.agent.asVersion(this.version))):(requestCfg.url="agents/profile",requestCfg.params.agent=JSON.stringify(cfg.agent.asVersion(this.version))),void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;if(null===err)if(404===xhr.status)result=null;else if(result=new TinCan.AgentProfile({id:key,agent:cfg.agent,contents:xhr.responseText}),void 0!==xhr.getResponseHeader&&null!==xhr.getResponseHeader("ETag")&&""!==xhr.getResponseHeader("ETag")?result.etag=xhr.getResponseHeader("ETag"):result.etag='"'+TinCan.Utils.getSHA1String(xhr.responseText)+'"',void 0!==xhr.contentType?result.contentType=xhr.contentType:void 0!==xhr.getResponseHeader&&null!==xhr.getResponseHeader("Content-Type")&&""!==xhr.getResponseHeader("Content-Type")&&(result.contentType=xhr.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(result.contentType))try{result.contents=JSON.parse(result.contents)}catch(ex){self.log("retrieveAgentProfile - failed to deserialize JSON: "+ex)}cfg.callback(err,result)},requestCfg.callback=callbackWrapper),requestResult=this.sendRequest(requestCfg),!callbackWrapper&&(requestResult.profile=null,null===requestResult.err&&404!==requestResult.xhr.status&&(requestResult.profile=new TinCan.AgentProfile({id:key,agent:cfg.agent,contents:requestResult.xhr.responseText}),void 0!==requestResult.xhr.getResponseHeader&&null!==requestResult.xhr.getResponseHeader("ETag")&&""!==requestResult.xhr.getResponseHeader("ETag")?requestResult.profile.etag=requestResult.xhr.getResponseHeader("ETag"):requestResult.profile.etag='"'+TinCan.Utils.getSHA1String(requestResult.xhr.responseText)+'"',void 0!==requestResult.xhr.contentType?requestResult.profile.contentType=requestResult.xhr.contentType:void 0!==requestResult.xhr.getResponseHeader&&null!==requestResult.xhr.getResponseHeader("Content-Type")&&""!==requestResult.xhr.getResponseHeader("Content-Type")&&(requestResult.profile.contentType=requestResult.xhr.getResponseHeader("Content-Type")),TinCan.Utils.isApplicationJSON(requestResult.profile.contentType))))try{requestResult.profile.contents=JSON.parse(requestResult.profile.contents)}catch(ex){this.log("retrieveAgentProfile - failed to deserialize JSON: "+ex)}return requestResult},retrieveAgentProfileIds:function(cfg){this.log("retrieveAgentProfileIds");var requestParams={},requestCfg,requestHeaders,requestResult,callbackWrapper;if(requestCfg={method:"GET",params:requestParams,headers:requestHeaders=(cfg=cfg||{}).requestHeaders||{},ignore404:!0},"0.9"===this.version?(requestCfg.url="actors/profile",requestParams.actor=JSON.stringify(cfg.agent.asVersion(this.version))):(requestCfg.url="agents/profile",requestParams.agent=JSON.stringify(cfg.agent.asVersion(this.version))),void 0!==cfg.callback&&(callbackWrapper=function(err,xhr){var result=xhr;if(null===err){if(404===xhr.status)result=[];else try{result=JSON.parse(xhr.responseText)}catch(ex){err="Response JSON parse error: "+ex}cfg.callback(err,result)}else cfg.callback(err,result)},requestCfg.callback=callbackWrapper),void 0!==cfg.since&&(requestCfg.params.since=cfg.since),requestResult=this.sendRequest(requestCfg),!callbackWrapper){if(requestResult.profileIds=null,null!==requestResult.err)return requestResult;if(404===requestResult.xhr.status)requestResult.profileIds=[];else try{requestResult.profileIds=JSON.parse(requestResult.xhr.responseText)}catch(ex){requestResult.err="retrieveAgentProfileIds - JSON parse error: "+ex}}return requestResult},saveAgentProfile:function(key,val,cfg){var requestCfg,requestHeaders;return this.log("saveAgentProfile"),requestHeaders=cfg.requestHeaders||{},void 0===cfg.contentType&&(cfg.contentType="application/octet-stream"),requestHeaders["Content-Type"]=cfg.contentType,void 0!==cfg.method&&"POST"===cfg.method||(cfg.method="PUT"),"object"==typeof val&&TinCan.Utils.isApplicationJSON(cfg.contentType)&&(val=JSON.stringify(val)),requestCfg={method:cfg.method,params:{profileId:key},data:val,headers:requestHeaders},"0.9"===this.version?(requestCfg.url="actors/profile",requestCfg.params.actor=JSON.stringify(cfg.agent.asVersion(this.version))):(requestCfg.url="agents/profile",requestCfg.params.agent=JSON.stringify(cfg.agent.asVersion(this.version))),void 0!==cfg.callback&&(requestCfg.callback=cfg.callback),void 0!==cfg.lastSHA1&&null!==cfg.lastSHA1?requestCfg.headers["If-Match"]=cfg.lastSHA1:requestCfg.headers["If-None-Match"]="*",this.sendRequest(requestCfg)},dropAgentProfile:function(key,cfg){var requestParams,requestCfg,requestHeaders;return this.log("dropAgentProfile"),requestCfg={method:"DELETE",params:requestParams={profileId:key},headers:requestHeaders=cfg.requestHeaders||{}},"0.9"===this.version?(requestCfg.url="actors/profile",requestParams.actor=JSON.stringify(cfg.agent.asVersion(this.version))):(requestCfg.url="agents/profile",requestParams.agent=JSON.stringify(cfg.agent.asVersion(this.version))),void 0!==cfg.callback&&(requestCfg.callback=cfg.callback),this.sendRequest(requestCfg)}},LRS.syncEnabled=null}(),function(){"use strict";var AgentAccount=TinCan.AgentAccount=function(cfg){this.log("constructor"),this.homePage=null,this.name=null,this.init(cfg)};AgentAccount.prototype={LOG_SRC:"AgentAccount",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["name","homePage"];for(void 0!==(cfg=cfg||{}).accountServiceHomePage&&(cfg.homePage=cfg.accountServiceHomePage),void 0!==cfg.accountName&&(cfg.name=cfg.accountName),i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]])},toString:function(){this.log("toString");var result="";return null!==this.name||null!==this.homePage?(result+=null!==this.name?this.name:"-",result+=":",result+=null!==this.homePage?this.homePage:"-"):result="AgentAccount: unidentified",result},asVersion:function(version){this.log("asVersion: "+version);var result={};return"0.9"===(version=version||TinCan.versions()[0])?(result.accountName=this.name,result.accountServiceHomePage=this.homePage):(result.name=this.name,result.homePage=this.homePage),result}},AgentAccount.fromJSON=function(acctJSON){AgentAccount.prototype.log("fromJSON");var _acct=JSON.parse(acctJSON);return new AgentAccount(_acct)}}(),function(){"use strict";var Agent=TinCan.Agent=function(cfg){this.log("constructor"),this.name=null,this.mbox=null,this.mbox_sha1sum=null,this.openid=null,this.account=null,this.degraded=!1,this.init(cfg)};Agent.prototype={objectType:"Agent",LOG_SRC:"Agent",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["name","mbox","mbox_sha1sum","openid"],val;for(void 0!==(cfg=cfg||{}).lastName||void 0!==cfg.firstName?(cfg.name="",void 0!==cfg.firstName&&cfg.firstName.length>0&&(cfg.name=cfg.firstName[0],cfg.firstName.length>1&&(this.degraded=!0)),""!==cfg.name&&(cfg.name+=" "),void 0!==cfg.lastName&&cfg.lastName.length>0&&(cfg.name+=cfg.lastName[0],cfg.lastName.length>1&&(this.degraded=!0))):void 0===cfg.familyName&&void 0===cfg.givenName||(cfg.name="",void 0!==cfg.givenName&&cfg.givenName.length>0&&(cfg.name=cfg.givenName[0],cfg.givenName.length>1&&(this.degraded=!0)),""!==cfg.name&&(cfg.name+=" "),void 0!==cfg.familyName&&cfg.familyName.length>0&&(cfg.name+=cfg.familyName[0],cfg.familyName.length>1&&(this.degraded=!0))),"object"==typeof cfg.name&&null!==cfg.name&&(cfg.name.length>1&&(this.degraded=!0),cfg.name=cfg.name[0]),"object"==typeof cfg.mbox&&null!==cfg.mbox&&(cfg.mbox.length>1&&(this.degraded=!0),cfg.mbox=cfg.mbox[0]),"object"==typeof cfg.mbox_sha1sum&&null!==cfg.mbox_sha1sum&&(cfg.mbox_sha1sum.length>1&&(this.degraded=!0),cfg.mbox_sha1sum=cfg.mbox_sha1sum[0]),"object"==typeof cfg.openid&&null!==cfg.openid&&(cfg.openid.length>1&&(this.degraded=!0),cfg.openid=cfg.openid[0]),"object"==typeof cfg.account&&null!==cfg.account&&void 0===cfg.account.homePage&&void 0===cfg.account.name&&(0===cfg.account.length?delete cfg.account:(cfg.account.length>1&&(this.degraded=!0),cfg.account=cfg.account[0])),cfg.hasOwnProperty("account")&&(cfg.account instanceof TinCan.AgentAccount?this.account=cfg.account:this.account=new TinCan.AgentAccount(cfg.account)),i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(val=cfg[directProps[i]],"mbox"===directProps[i]&&-1===val.indexOf("mailto:")&&(val="mailto:"+val),this[directProps[i]]=val)},toString:function(){return this.log("toString"),null!==this.name?this.name:null!==this.mbox?this.mbox.replace("mailto:",""):null!==this.mbox_sha1sum?this.mbox_sha1sum:null!==this.openid?this.openid:null!==this.account?this.account.toString():this.objectType+": unidentified"},asVersion:function(version){this.log("asVersion: "+version);var result={objectType:this.objectType};return"0.9"===(version=version||TinCan.versions()[0])?(null!==this.mbox?result.mbox=[this.mbox]:null!==this.mbox_sha1sum?result.mbox_sha1sum=[this.mbox_sha1sum]:null!==this.openid?result.openid=[this.openid]:null!==this.account&&(result.account=[this.account.asVersion(version)]),null!==this.name&&(result.name=[this.name])):(null!==this.mbox?result.mbox=this.mbox:null!==this.mbox_sha1sum?result.mbox_sha1sum=this.mbox_sha1sum:null!==this.openid?result.openid=this.openid:null!==this.account&&(result.account=this.account.asVersion(version)),null!==this.name&&(result.name=this.name)),result}},Agent.fromJSON=function(agentJSON){Agent.prototype.log("fromJSON");var _agent=JSON.parse(agentJSON);return new Agent(_agent)}}(),function(){"use strict";var Group=TinCan.Group=function(cfg){this.log("constructor"),this.name=null,this.mbox=null,this.mbox_sha1sum=null,this.openid=null,this.account=null,this.member=[],this.init(cfg)};Group.prototype={objectType:"Group",LOG_SRC:"Group",log:TinCan.prototype.log,init:function(cfg){var i;if(this.log("init"),cfg=cfg||{},TinCan.Agent.prototype.init.call(this,cfg),void 0!==cfg.member)for(i=0;i<cfg.member.length;i+=1)cfg.member[i]instanceof TinCan.Agent?this.member.push(cfg.member[i]):this.member.push(new TinCan.Agent(cfg.member[i]))},toString:function(lang){this.log("toString");var result=TinCan.Agent.prototype.toString.call(this,lang);return result!==this.objectType+": unidentified"&&(result=this.objectType+": "+result),result},asVersion:function(version){var result,i;if(this.log("asVersion: "+version),version=version||TinCan.versions()[0],result=TinCan.Agent.prototype.asVersion.call(this,version),this.member.length>0)for(result.member=[],i=0;i<this.member.length;i+=1)result.member.push(this.member[i].asVersion(version));return result}},Group.fromJSON=function(groupJSON){Group.prototype.log("fromJSON");var _group=JSON.parse(groupJSON);return new Group(_group)}}(),function(){"use strict";var _downConvertMap={"http://adlnet.gov/expapi/verbs/experienced":"experienced","http://adlnet.gov/expapi/verbs/attended":"attended","http://adlnet.gov/expapi/verbs/attempted":"attempted","http://adlnet.gov/expapi/verbs/completed":"completed","http://adlnet.gov/expapi/verbs/passed":"passed","http://adlnet.gov/expapi/verbs/failed":"failed","http://adlnet.gov/expapi/verbs/answered":"answered","http://adlnet.gov/expapi/verbs/interacted":"interacted","http://adlnet.gov/expapi/verbs/imported":"imported","http://adlnet.gov/expapi/verbs/created":"created","http://adlnet.gov/expapi/verbs/shared":"shared","http://adlnet.gov/expapi/verbs/voided":"voided"},Verb=TinCan.Verb=function(cfg){this.log("constructor"),this.id=null,this.display=null,this.init(cfg)};Verb.prototype={LOG_SRC:"Verb",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["id","display"],prop;if("string"==typeof cfg){for(prop in this.id=cfg,this.display={und:this.id},_downConvertMap)if(_downConvertMap.hasOwnProperty(prop)&&_downConvertMap[prop]===cfg){this.id=prop;break}}else{for(cfg=cfg||{},i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]]);null===this.display&&void 0!==_downConvertMap[this.id]&&(this.display={und:_downConvertMap[this.id]})}},toString:function(lang){return this.log("toString"),null!==this.display?this.getLangDictionaryValue("display",lang):this.id},asVersion:function(version){var result;return this.log("asVersion"),"0.9"===(version=version||TinCan.versions()[0])?result=_downConvertMap[this.id]:(result={id:this.id},null!==this.display&&(result.display=this.display)),result},getLangDictionaryValue:TinCan.Utils.getLangDictionaryValue},Verb.fromJSON=function(verbJSON){Verb.prototype.log("fromJSON");var _verb=JSON.parse(verbJSON);return new Verb(_verb)}}(),function(){"use strict";var Result=TinCan.Result=function(cfg){this.log("constructor"),this.score=null,this.success=null,this.completion=null,this.duration=null,this.response=null,this.extensions=null,this.init(cfg)};Result.prototype={LOG_SRC:"Result",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["completion","duration","extensions","response","success"];for((cfg=cfg||{}).hasOwnProperty("score")&&null!==cfg.score&&(cfg.score instanceof TinCan.Score?this.score=cfg.score:this.score=new TinCan.Score(cfg.score)),i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]]);"Completed"===this.completion&&(this.completion=!0)},asVersion:function(version){this.log("asVersion");var result={},optionalDirectProps=["success","duration","response","extensions"],optionalObjProps=["score"],i;for(version=version||TinCan.versions()[0],i=0;i<optionalDirectProps.length;i+=1)null!==this[optionalDirectProps[i]]&&(result[optionalDirectProps[i]]=this[optionalDirectProps[i]]);for(i=0;i<optionalObjProps.length;i+=1)null!==this[optionalObjProps[i]]&&(result[optionalObjProps[i]]=this[optionalObjProps[i]].asVersion(version));return null!==this.completion&&("0.9"===version?this.completion&&(result.completion="Completed"):result.completion=this.completion),result}},Result.fromJSON=function(resultJSON){Result.prototype.log("fromJSON");var _result=JSON.parse(resultJSON);return new Result(_result)}}(),function(){"use strict";var Score=TinCan.Score=function(cfg){this.log("constructor"),this.scaled=null,this.raw=null,this.min=null,this.max=null,this.init(cfg)};Score.prototype={LOG_SRC:"Score",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["scaled","raw","min","max"];for(cfg=cfg||{},i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]])},asVersion:function(version){this.log("asVersion");var result={},optionalDirectProps=["scaled","raw","min","max"],i;for(version=version||TinCan.versions()[0],i=0;i<optionalDirectProps.length;i+=1)null!==this[optionalDirectProps[i]]&&(result[optionalDirectProps[i]]=this[optionalDirectProps[i]]);return result}},Score.fromJSON=function(scoreJSON){Score.prototype.log("fromJSON");var _score=JSON.parse(scoreJSON);return new Score(_score)}}(),function(){"use strict";var InteractionComponent=TinCan.InteractionComponent=function(cfg){this.log("constructor"),this.id=null,this.description=null,this.init(cfg)};InteractionComponent.prototype={LOG_SRC:"InteractionComponent",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["id","description"];for(cfg=cfg||{},i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]])},asVersion:function(version){this.log("asVersion");var result={id:this.id},optionalDirectProps=["description"],i,prop;for(version=version||TinCan.versions()[0],i=0;i<optionalDirectProps.length;i+=1)null!==this[prop=optionalDirectProps[i]]&&(result[prop]=this[prop]);return result},getLangDictionaryValue:TinCan.Utils.getLangDictionaryValue},InteractionComponent.fromJSON=function(icJSON){InteractionComponent.prototype.log("fromJSON");var _ic=JSON.parse(icJSON);return new InteractionComponent(_ic)}}(),function(){"use strict";var _downConvertMap={"http://adlnet.gov/expapi/activities/course":"course","http://adlnet.gov/expapi/activities/module":"module","http://adlnet.gov/expapi/activities/meeting":"meeting","http://adlnet.gov/expapi/activities/media":"media","http://adlnet.gov/expapi/activities/performance":"performance","http://adlnet.gov/expapi/activities/simulation":"simulation","http://adlnet.gov/expapi/activities/assessment":"assessment","http://adlnet.gov/expapi/activities/interaction":"interaction","http://adlnet.gov/expapi/activities/cmi.interaction":"cmi.interaction","http://adlnet.gov/expapi/activities/question":"question","http://adlnet.gov/expapi/activities/objective":"objective","http://adlnet.gov/expapi/activities/link":"link"},ActivityDefinition=TinCan.ActivityDefinition=function(cfg){this.log("constructor"),this.name=null,this.description=null,this.type=null,this.moreInfo=null,this.extensions=null,this.interactionType=null,this.correctResponsesPattern=null,this.choices=null,this.scale=null,this.source=null,this.target=null,this.steps=null,this.init(cfg)};ActivityDefinition.prototype={LOG_SRC:"ActivityDefinition",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,j,prop,directProps=["name","description","moreInfo","extensions","correctResponsesPattern"],interactionComponentProps=[];if((cfg=cfg||{}).hasOwnProperty("type")&&null!==cfg.type){for(prop in _downConvertMap)_downConvertMap.hasOwnProperty(prop)&&_downConvertMap[prop]===cfg.type&&(cfg.type=_downConvertMap[prop]);this.type=cfg.type}if(cfg.hasOwnProperty("interactionType")&&null!==cfg.interactionType&&(this.interactionType=cfg.interactionType,"choice"===cfg.interactionType||"sequencing"===cfg.interactionType?interactionComponentProps.push("choices"):"likert"===cfg.interactionType?interactionComponentProps.push("scale"):"matching"===cfg.interactionType?(interactionComponentProps.push("source"),interactionComponentProps.push("target")):"performance"===cfg.interactionType&&interactionComponentProps.push("steps"),interactionComponentProps.length>0))for(i=0;i<interactionComponentProps.length;i+=1)if(prop=interactionComponentProps[i],cfg.hasOwnProperty(prop)&&null!==cfg[prop])for(this[prop]=[],j=0;j<cfg[prop].length;j+=1)cfg[prop][j]instanceof TinCan.InteractionComponent?this[prop].push(cfg[prop][j]):this[prop].push(new TinCan.InteractionComponent(cfg[prop][j]));for(i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]])},toString:function(lang){return this.log("toString"),null!==this.name?this.getLangDictionaryValue("name",lang):null!==this.description?this.getLangDictionaryValue("description",lang):""},asVersion:function(version){this.log("asVersion");var result={},directProps=["name","description","interactionType","correctResponsesPattern","extensions"],interactionComponentProps=["choices","scale","source","target","steps"],i,j,prop;for(version=version||TinCan.versions()[0],null!==this.type&&(result.type="0.9"===version?_downConvertMap[this.type]:this.type),i=0;i<directProps.length;i+=1)null!==this[prop=directProps[i]]&&(result[prop]=this[prop]);for(i=0;i<interactionComponentProps.length;i+=1)if(null!==this[prop=interactionComponentProps[i]])for(result[prop]=[],j=0;j<this[prop].length;j+=1)result[prop].push(this[prop][j].asVersion(version));return 0!==version.indexOf("0.9")&&null!==this.moreInfo&&(result.moreInfo=this.moreInfo),result},getLangDictionaryValue:TinCan.Utils.getLangDictionaryValue},ActivityDefinition.fromJSON=function(definitionJSON){ActivityDefinition.prototype.log("fromJSON");var _definition=JSON.parse(definitionJSON);return new ActivityDefinition(_definition)}}(),function(){"use strict";var Activity=TinCan.Activity=function(cfg){this.log("constructor"),this.objectType="Activity",this.id=null,this.definition=null,this.init(cfg)};Activity.prototype={LOG_SRC:"Activity",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["id"];for((cfg=cfg||{}).hasOwnProperty("definition")&&(cfg.definition instanceof TinCan.ActivityDefinition?this.definition=cfg.definition:this.definition=new TinCan.ActivityDefinition(cfg.definition)),i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]])},toString:function(lang){this.log("toString");var defString="";return null!==this.definition&&""!==(defString=this.definition.toString(lang))?defString:null!==this.id?this.id:"Activity: unidentified"},asVersion:function(version){this.log("asVersion");var result={id:this.id,objectType:this.objectType};return version=version||TinCan.versions()[0],null!==this.definition&&(result.definition=this.definition.asVersion(version)),result}},Activity.fromJSON=function(activityJSON){Activity.prototype.log("fromJSON");var _activity=JSON.parse(activityJSON);return new Activity(_activity)}}(),function(){"use strict";var ContextActivities=TinCan.ContextActivities=function(cfg){this.log("constructor"),this.category=null,this.parent=null,this.grouping=null,this.other=null,this.init(cfg)};ContextActivities.prototype={LOG_SRC:"ContextActivities",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,j,objProps=["category","parent","grouping","other"],prop,val;for(cfg=cfg||{},i=0;i<objProps.length;i+=1)if(prop=objProps[i],cfg.hasOwnProperty(prop)&&null!==cfg[prop])if("[object Array]"===Object.prototype.toString.call(cfg[prop]))for(j=0;j<cfg[prop].length;j+=1)this.add(prop,cfg[prop][j]);else val=cfg[prop],this.add(prop,val)},add:function(key,val){if("category"===key||"parent"===key||"grouping"===key||"other"===key)return null===this[key]&&(this[key]=[]),val instanceof TinCan.Activity||(val="string"==typeof val?{id:val}:val,val=new TinCan.Activity(val)),this[key].push(val),this[key].length-1},asVersion:function(version){this.log("asVersion");var result={},optionalObjProps=["parent","grouping","other"],i,j;for(version=version||TinCan.versions()[0],i=0;i<optionalObjProps.length;i+=1)if(null!==this[optionalObjProps[i]]&&this[optionalObjProps[i]].length>0)if("0.9"===version||"0.95"===version)this[optionalObjProps[i]].length>1&&this.log("[warning] version does not support multiple values in: "+optionalObjProps[i]),result[optionalObjProps[i]]=this[optionalObjProps[i]][0].asVersion(version);else for(result[optionalObjProps[i]]=[],j=0;j<this[optionalObjProps[i]].length;j+=1)result[optionalObjProps[i]].push(this[optionalObjProps[i]][j].asVersion(version));if(null!==this.category&&this.category.length>0){if("0.9"===version||"0.95"===version)throw this.log("[error] version does not support the 'category' property: "+version),new Error(version+" does not support the 'category' property");for(result.category=[],i=0;i<this.category.length;i+=1)result.category.push(this.category[i].asVersion(version))}return result}},ContextActivities.fromJSON=function(contextActivitiesJSON){ContextActivities.prototype.log("fromJSON");var _contextActivities=JSON.parse(contextActivitiesJSON);return new ContextActivities(_contextActivities)}}(),function(){"use strict";var Context=TinCan.Context=function(cfg){this.log("constructor"),this.registration=null,this.instructor=null,this.team=null,this.contextActivities=null,this.revision=null,this.platform=null,this.language=null,this.statement=null,this.extensions=null,this.init(cfg)};Context.prototype={LOG_SRC:"Context",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["registration","revision","platform","language","extensions"],agentGroupProps=["instructor","team"],prop,val;for(cfg=cfg||{},i=0;i<directProps.length;i+=1)prop=directProps[i],cfg.hasOwnProperty(prop)&&null!==cfg[prop]&&(this[prop]=cfg[prop]);for(i=0;i<agentGroupProps.length;i+=1)prop=agentGroupProps[i],cfg.hasOwnProperty(prop)&&null!==cfg[prop]&&(void 0!==(val=cfg[prop]).objectType&&"Person"!==val.objectType||(val.objectType="Agent"),"Agent"!==val.objectType||val instanceof TinCan.Agent?"Group"!==val.objectType||val instanceof TinCan.Group||(val=new TinCan.Group(val)):val=new TinCan.Agent(val),this[prop]=val);cfg.hasOwnProperty("contextActivities")&&null!==cfg.contextActivities&&(cfg.contextActivities instanceof TinCan.ContextActivities?this.contextActivities=cfg.contextActivities:this.contextActivities=new TinCan.ContextActivities(cfg.contextActivities)),cfg.hasOwnProperty("statement")&&null!==cfg.statement&&(cfg.statement instanceof TinCan.StatementRef?this.statement=cfg.statement:cfg.statement instanceof TinCan.SubStatement?this.statement=cfg.statement:"StatementRef"===cfg.statement.objectType?this.statement=new TinCan.StatementRef(cfg.statement):"SubStatement"===cfg.statement.objectType?this.statement=new TinCan.SubStatement(cfg.statement):this.log("Unable to parse statement.context.statement property."))},asVersion:function(version){this.log("asVersion");var result={},optionalDirectProps=["registration","revision","platform","language","extensions"],optionalObjProps=["instructor","team","contextActivities","statement"],i;if(version=version||TinCan.versions()[0],this.statement instanceof TinCan.SubStatement&&"0.9"!==version&&"0.95"!==version)throw this.log("[error] version does not support SubStatements in the 'statement' property: "+version),new Error(version+" does not support SubStatements in the 'statement' property");for(i=0;i<optionalDirectProps.length;i+=1)null!==this[optionalDirectProps[i]]&&(result[optionalDirectProps[i]]=this[optionalDirectProps[i]]);for(i=0;i<optionalObjProps.length;i+=1)null!==this[optionalObjProps[i]]&&(result[optionalObjProps[i]]=this[optionalObjProps[i]].asVersion(version));return result}},Context.fromJSON=function(contextJSON){Context.prototype.log("fromJSON");var _context=JSON.parse(contextJSON);return new Context(_context)}}(),function(){"use strict";var StatementRef=TinCan.StatementRef=function(cfg){this.log("constructor"),this.id=null,this.init(cfg)};StatementRef.prototype={objectType:"StatementRef",LOG_SRC:"StatementRef",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["id"];for(cfg=cfg||{},i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]])},toString:function(){return this.log("toString"),this.id},asVersion:function(version){this.log("asVersion");var result={objectType:this.objectType,id:this.id};return"0.9"===version&&(result.objectType="Statement"),result}},StatementRef.fromJSON=function(stRefJSON){StatementRef.prototype.log("fromJSON");var _stRef=JSON.parse(stRefJSON);return new StatementRef(_stRef)}}(),function(){"use strict";var SubStatement=TinCan.SubStatement=function(cfg){this.log("constructor"),this.actor=null,this.verb=null,this.target=null,this.result=null,this.context=null,this.timestamp=null,this.init(cfg)};SubStatement.prototype={objectType:"SubStatement",LOG_SRC:"SubStatement",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["timestamp"];for((cfg=cfg||{}).hasOwnProperty("object")&&(cfg.target=cfg.object),cfg.hasOwnProperty("actor")&&(void 0!==cfg.actor.objectType&&"Person"!==cfg.actor.objectType||(cfg.actor.objectType="Agent"),"Agent"===cfg.actor.objectType?cfg.actor instanceof TinCan.Agent?this.actor=cfg.actor:this.actor=new TinCan.Agent(cfg.actor):"Group"===cfg.actor.objectType&&(cfg.actor instanceof TinCan.Group?this.actor=cfg.actor:this.actor=new TinCan.Group(cfg.actor))),cfg.hasOwnProperty("verb")&&(cfg.verb instanceof TinCan.Verb?this.verb=cfg.verb:this.verb=new TinCan.Verb(cfg.verb)),cfg.hasOwnProperty("target")&&(cfg.target instanceof TinCan.Activity||cfg.target instanceof TinCan.Agent||cfg.target instanceof TinCan.Group||cfg.target instanceof TinCan.SubStatement||cfg.target instanceof TinCan.StatementRef?this.target=cfg.target:(void 0===cfg.target.objectType&&(cfg.target.objectType="Activity"),"Activity"===cfg.target.objectType?this.target=new TinCan.Activity(cfg.target):"Agent"===cfg.target.objectType?this.target=new TinCan.Agent(cfg.target):"Group"===cfg.target.objectType?this.target=new TinCan.Group(cfg.target):"SubStatement"===cfg.target.objectType?this.target=new TinCan.SubStatement(cfg.target):"StatementRef"===cfg.target.objectType?this.target=new TinCan.StatementRef(cfg.target):this.log("Unrecognized target type: "+cfg.target.objectType))),cfg.hasOwnProperty("result")&&(cfg.result instanceof TinCan.Result?this.result=cfg.result:this.result=new TinCan.Result(cfg.result)),cfg.hasOwnProperty("context")&&(cfg.context instanceof TinCan.Context?this.context=cfg.context:this.context=new TinCan.Context(cfg.context)),i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]])},toString:function(lang){return this.log("toString"),(null!==this.actor?this.actor.toString(lang):"")+" "+(null!==this.verb?this.verb.toString(lang):"")+" "+(null!==this.target?this.target.toString(lang):"")},asVersion:function(version){this.log("asVersion");var result,optionalDirectProps=["timestamp"],optionalObjProps=["actor","verb","result","context"],i;for(result={objectType:this.objectType},version=version||TinCan.versions()[0],i=0;i<optionalDirectProps.length;i+=1)null!==this[optionalDirectProps[i]]&&(result[optionalDirectProps[i]]=this[optionalDirectProps[i]]);for(i=0;i<optionalObjProps.length;i+=1)null!==this[optionalObjProps[i]]&&(result[optionalObjProps[i]]=this[optionalObjProps[i]].asVersion(version));return null!==this.target&&(result.object=this.target.asVersion(version)),"0.9"===version&&(result.objectType="Statement"),result}},SubStatement.fromJSON=function(subStJSON){SubStatement.prototype.log("fromJSON");var _subSt=JSON.parse(subStJSON);return new SubStatement(_subSt)}}(),function(){"use strict";var Statement=TinCan.Statement=function(cfg,initCfg){this.log("constructor"),void 0===(initCfg="number"==typeof initCfg?{storeOriginal:initCfg}:initCfg||{}).storeOriginal&&(initCfg.storeOriginal=null),void 0===initCfg.doStamp&&(initCfg.doStamp=!0),this.id=null,this.actor=null,this.verb=null,this.target=null,this.result=null,this.context=null,this.timestamp=null,this.stored=null,this.authority=null,this.attachments=null,this.version=null,this.degraded=!1,this.voided=null,this.inProgress=null,this.originalJSON=null,this.init(cfg,initCfg)};Statement.prototype={LOG_SRC:"Statement",log:TinCan.prototype.log,init:function(cfg,initCfg){this.log("init");var i,directProps=["id","stored","timestamp","version","inProgress","voided"];if(cfg=cfg||{},initCfg.storeOriginal&&(this.originalJSON=JSON.stringify(cfg,null,initCfg.storeOriginal)),cfg.hasOwnProperty("object")&&(cfg.target=cfg.object),cfg.hasOwnProperty("actor")&&(void 0!==cfg.actor.objectType&&"Person"!==cfg.actor.objectType||(cfg.actor.objectType="Agent"),"Agent"===cfg.actor.objectType?cfg.actor instanceof TinCan.Agent?this.actor=cfg.actor:this.actor=new TinCan.Agent(cfg.actor):"Group"===cfg.actor.objectType&&(cfg.actor instanceof TinCan.Group?this.actor=cfg.actor:this.actor=new TinCan.Group(cfg.actor))),cfg.hasOwnProperty("authority")&&(void 0!==cfg.authority.objectType&&"Person"!==cfg.authority.objectType||(cfg.authority.objectType="Agent"),"Agent"===cfg.authority.objectType?cfg.authority instanceof TinCan.Agent?this.authority=cfg.authority:this.authority=new TinCan.Agent(cfg.authority):"Group"===cfg.authority.objectType&&(cfg.actor instanceof TinCan.Group?this.authority=cfg.authority:this.authority=new TinCan.Group(cfg.authority))),cfg.hasOwnProperty("verb")&&(cfg.verb instanceof TinCan.Verb?this.verb=cfg.verb:this.verb=new TinCan.Verb(cfg.verb)),cfg.hasOwnProperty("target")&&(cfg.target instanceof TinCan.Activity||cfg.target instanceof TinCan.Agent||cfg.target instanceof TinCan.Group||cfg.target instanceof TinCan.SubStatement||cfg.target instanceof TinCan.StatementRef?this.target=cfg.target:(void 0===cfg.target.objectType&&(cfg.target.objectType="Activity"),"Activity"===cfg.target.objectType?this.target=new TinCan.Activity(cfg.target):"Agent"===cfg.target.objectType?this.target=new TinCan.Agent(cfg.target):"Group"===cfg.target.objectType?this.target=new TinCan.Group(cfg.target):"SubStatement"===cfg.target.objectType?this.target=new TinCan.SubStatement(cfg.target):"StatementRef"===cfg.target.objectType?this.target=new TinCan.StatementRef(cfg.target):this.log("Unrecognized target type: "+cfg.target.objectType))),cfg.hasOwnProperty("result")&&(cfg.result instanceof TinCan.Result?this.result=cfg.result:this.result=new TinCan.Result(cfg.result)),cfg.hasOwnProperty("context")&&(cfg.context instanceof TinCan.Context?this.context=cfg.context:this.context=new TinCan.Context(cfg.context)),cfg.hasOwnProperty("attachments")&&null!==cfg.attachments)for(this.attachments=[],i=0;i<cfg.attachments.length;i+=1)cfg.attachments[i]instanceof TinCan.Attachment?this.attachments.push(cfg.attachments[i]):this.attachments.push(new TinCan.Attachment(cfg.attachments[i]));for(i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]]);initCfg.doStamp&&this.stamp()},toString:function(lang){return this.log("toString"),(null!==this.actor?this.actor.toString(lang):"")+" "+(null!==this.verb?this.verb.toString(lang):"")+" "+(null!==this.target?this.target.toString(lang):"")},asVersion:function(version){this.log("asVersion");var result={},optionalDirectProps=["id","timestamp"],optionalObjProps=["actor","verb","result","context","authority"],i;for(version=version||TinCan.versions()[0],i=0;i<optionalDirectProps.length;i+=1)null!==this[optionalDirectProps[i]]&&(result[optionalDirectProps[i]]=this[optionalDirectProps[i]]);for(i=0;i<optionalObjProps.length;i+=1)null!==this[optionalObjProps[i]]&&(result[optionalObjProps[i]]=this[optionalObjProps[i]].asVersion(version));if(null!==this.target&&(result.object=this.target.asVersion(version)),"0.9"!==version&&"0.95"!==version||null!==this.voided&&(result.voided=this.voided),"0.9"===version&&null!==this.inProgress&&(result.inProgress=this.inProgress),null!==this.attachments&&"0.9"!==version&&"0.95"!==version)for(result.attachments=[],i=0;i<this.attachments.length;i+=1)this.attachments[i]instanceof TinCan.Attachment?result.attachments.push(this.attachments[i].asVersion(version)):result.attachments.push(new TinCan.Attachment(this.attachments[i]).asVersion(version));return result},stamp:function(){this.log("stamp"),null===this.id&&(this.id=TinCan.Utils.getUUID()),null===this.timestamp&&(this.timestamp=TinCan.Utils.getISODateString(new Date))},hasAttachmentWithContent:function(){var i;if(this.log("hasAttachmentWithContent"),null===this.attachments)return!1;for(i=0;i<this.attachments.length;i+=1)if(null!==this.attachments[i].content)return!0;return!1}},Statement.fromJSON=function(stJSON){Statement.prototype.log("fromJSON");var _st=JSON.parse(stJSON);return new Statement(_st)}}(),function(){"use strict";var StatementsResult=TinCan.StatementsResult=function(cfg){this.log("constructor"),this.statements=null,this.more=null,this.init(cfg)};StatementsResult.prototype={LOG_SRC:"StatementsResult",log:TinCan.prototype.log,init:function(cfg){this.log("init"),(cfg=cfg||{}).hasOwnProperty("statements")&&(this.statements=cfg.statements),cfg.hasOwnProperty("more")&&(this.more=cfg.more)}},StatementsResult.fromJSON=function(resultJSON){StatementsResult.prototype.log("fromJSON");var _result,stmts=[],stmt,i;try{_result=JSON.parse(resultJSON)}catch(parseError){StatementsResult.prototype.log("fromJSON - JSON.parse error: "+parseError)}if(_result){for(i=0;i<_result.statements.length;i+=1){try{stmt=new TinCan.Statement(_result.statements[i],4)}catch(error){StatementsResult.prototype.log("fromJSON - statement instantiation failed: "+error+" ("+JSON.stringify(_result.statements[i])+")"),stmt=new TinCan.Statement({id:_result.statements[i].id},4)}stmts.push(stmt)}_result.statements=stmts}return new StatementsResult(_result)}}(),function(){"use strict";var State=TinCan.State=function(cfg){this.log("constructor"),this.id=null,this.updated=null,this.contents=null,this.etag=null,this.contentType=null,this.init(cfg)};State.prototype={LOG_SRC:"State",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["id","contents","etag","contentType"];for(cfg=cfg||{},i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]]);this.updated=!1}},State.fromJSON=function(stateJSON){State.prototype.log("fromJSON");var _state=JSON.parse(stateJSON);return new State(_state)}}(),function(){"use strict";var ActivityProfile=TinCan.ActivityProfile=function(cfg){this.log("constructor"),this.id=null,this.activity=null,this.updated=null,this.contents=null,this.etag=null,this.contentType=null,this.init(cfg)};ActivityProfile.prototype={LOG_SRC:"ActivityProfile",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["id","contents","etag","contentType"];for((cfg=cfg||{}).hasOwnProperty("activity")&&(cfg.activity instanceof TinCan.Activity?this.activity=cfg.activity:this.activity=new TinCan.Activity(cfg.activity)),i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]]);this.updated=!1}},ActivityProfile.fromJSON=function(stateJSON){ActivityProfile.prototype.log("fromJSON");var _state=JSON.parse(stateJSON);return new ActivityProfile(_state)}}(),function(){"use strict";var AgentProfile=TinCan.AgentProfile=function(cfg){this.log("constructor"),this.id=null,this.agent=null,this.updated=null,this.contents=null,this.etag=null,this.contentType=null,this.init(cfg)};AgentProfile.prototype={LOG_SRC:"AgentProfile",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["id","contents","etag","contentType"];for((cfg=cfg||{}).hasOwnProperty("agent")&&(cfg.agent instanceof TinCan.Agent?this.agent=cfg.agent:this.agent=new TinCan.Agent(cfg.agent)),i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]]);this.updated=!1}},AgentProfile.fromJSON=function(stateJSON){AgentProfile.prototype.log("fromJSON");var _state=JSON.parse(stateJSON);return new AgentProfile(_state)}}(),function(){"use strict";var About=TinCan.About=function(cfg){this.log("constructor"),this.version=null,this.init(cfg)};About.prototype={LOG_SRC:"About",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["version"];for(cfg=cfg||{},i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]])}},About.fromJSON=function(aboutJSON){About.prototype.log("fromJSON");var _about=JSON.parse(aboutJSON);return new About(_about)}}(),function(){"use strict";var Attachment=TinCan.Attachment=function(cfg){this.log("constructor"),this.usageType=null,this.display=null,this.contentType=null,this.length=null,this.sha2=null,this.description=null,this.fileUrl=null,this.content=null,this.init(cfg)};Attachment.prototype={LOG_SRC:"Attachment",log:TinCan.prototype.log,init:function(cfg){this.log("init");var i,directProps=["contentType","length","sha2","usageType","display","description","fileUrl"];for(cfg=cfg||{},i=0;i<directProps.length;i+=1)cfg.hasOwnProperty(directProps[i])&&null!==cfg[directProps[i]]&&(this[directProps[i]]=cfg[directProps[i]]);cfg.hasOwnProperty("content")&&null!==cfg.content&&("string"==typeof cfg.content?this.setContentFromString(cfg.content):this.setContent(cfg.content))},asVersion:function(version){var result;return this.log("asVersion"),"0.9"===(version=version||TinCan.versions()[0])||"0.95"===version?result=null:(result={contentType:this.contentType,display:this.display,length:this.length,sha2:this.sha2,usageType:this.usageType},null!==this.fileUrl&&(result.fileUrl=this.fileUrl),null!==this.description&&(result.description=this.description)),result},getLangDictionaryValue:TinCan.Utils.getLangDictionaryValue,setContent:function(content){this.content=content,this.length=content.byteLength,this.sha2=TinCan.Utils.getSHA256String(content)},setContentFromString:function(content){var _content=content;_content=TinCan.Utils.stringToArrayBuffer(content),this.setContent(_content)},getContentAsString:function(){return TinCan.Utils.stringFromArrayBuffer(this.content)}},Attachment.fromJSON=function(attachmentJSON){Attachment.prototype.log("fromJSON");var _attachment=JSON.parse(attachmentJSON);return new Attachment(_attachment)},Attachment._defaultEncoding="utf-8"}(),function(){"use strict";var LOG_SRC="Environment.Browser",requestComplete,__IEModeConversion,nativeRequest,xdrRequest,__createJSONSegment,__createAttachmentSegment,__delay,env={},log=TinCan.prototype.log;"undefined"!=typeof window?(window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(vContent){var sOutput="",nId,sProp;if(vContent instanceof Object){if(vContent.constructor===Array){for(nId=0;nId<vContent.length;nId+=1)sOutput+=this.stringify(vContent[nId])+",";return"["+sOutput.substr(0,sOutput.length-1)+"]"}if(vContent.toString!==Object.prototype.toString)return'"'+vContent.toString().replace(/"/g,"\\$&")+'"';for(sProp in vContent)vContent.hasOwnProperty(sProp)&&(sOutput+='"'+sProp.replace(/"/g,"\\$&")+'":'+this.stringify(vContent[sProp])+",");return"{"+sOutput.substr(0,sOutput.length-1)+"}"}return"string"==typeof vContent?'"'+vContent.replace(/"/g,"\\$&")+'"':String(vContent)}}),Date.now||(Date.now=function(){return+new Date}),Array.prototype.forEach||(Array.prototype.forEach=function(fun){if(null==this)throw new TypeError;var t=Object(this),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;var thisp=arguments[1],i;for(i=0;i<len;i+=1)i in t&&fun.call(thisp,t[i],i,t)}),env.hasCORS=!1,env.useXDR=!1,"undefined"!=typeof XMLHttpRequest&&void 0!==(new XMLHttpRequest).withCredentials?env.hasCORS=!0:"undefined"!=typeof XDomainRequest&&(env.hasCORS=!0,env.useXDR=!0),requestComplete=function(xhr,cfg,control){var requestCompleteResult,notFoundOk,httpStatus;return log("requestComplete: "+control.finished+", xhr.status: "+xhr.status,LOG_SRC),httpStatus=void 0===xhr.status?control.fakeStatus:1223===xhr.status?204:xhr.status,control.finished?requestCompleteResult:(control.finished=!0,notFoundOk=cfg.ignore404&&404===httpStatus,httpStatus>=200&&httpStatus<400||notFoundOk?cfg.callback?void cfg.callback(null,xhr):requestCompleteResult={err:null,xhr:xhr}:(requestCompleteResult={err:httpStatus,xhr:xhr},log(0===httpStatus?"[warning] There was a problem communicating with the Learning Record Store. Aborted, offline, or invalid CORS endpoint ("+httpStatus+")":"[warning] There was a problem communicating with the Learning Record Store. ("+httpStatus+" | "+xhr.responseText+")",LOG_SRC),cfg.callback&&cfg.callback(httpStatus,xhr),requestCompleteResult))},__IEModeConversion=function(fullUrl,headers,pairs,cfg){var prop;for(prop in headers)headers.hasOwnProperty(prop)&&pairs.push(prop+"="+encodeURIComponent(headers[prop]));return void 0!==cfg.data&&pairs.push("content="+encodeURIComponent(cfg.data)),headers["Content-Type"]="application/x-www-form-urlencoded",fullUrl+="?method="+cfg.method,cfg.method="POST",cfg.params={},pairs.length>0&&(cfg.data=pairs.join("&")),fullUrl},nativeRequest=function(fullUrl,headers,cfg){log("sendRequest using XMLHttpRequest",LOG_SRC);var self=this,xhr,prop,pairs=[],data,control={finished:!1,fakeStatus:null},async=void 0!==cfg.callback,fullRequest=fullUrl,err,MAX_REQUEST_LENGTH=2048;for(prop in log("sendRequest using XMLHttpRequest - async: "+async,LOG_SRC),cfg.params)cfg.params.hasOwnProperty(prop)&&pairs.push(prop+"="+encodeURIComponent(cfg.params[prop]));if(pairs.length>0&&(fullRequest+="?"+pairs.join("&")),fullRequest.length>=2048){if(void 0===cfg.method)return err=new Error("method must not be undefined for an IE Mode Request conversion"),void 0!==cfg.callback&&cfg.callback(err,null),{err:err,xhr:null};fullUrl=__IEModeConversion(fullUrl,headers,pairs,cfg)}else fullUrl=fullRequest;for(prop in"undefined"!=typeof XMLHttpRequest&&(xhr=new XMLHttpRequest),xhr.open(cfg.method,fullUrl,async),cfg.expectMultipart&&(xhr.responseType="arraybuffer"),headers)headers.hasOwnProperty(prop)&&xhr.setRequestHeader(prop,headers[prop]);data=cfg.data,async&&(xhr.onreadystatechange=function(){log("xhr.onreadystatechange - xhr.readyState: "+xhr.readyState,LOG_SRC),4===xhr.readyState&&requestComplete.call(self,xhr,cfg,control)});try{xhr.send(data)}catch(ex){log("sendRequest caught send exception: "+ex,LOG_SRC)}return async?xhr:requestComplete.call(this,xhr,cfg,control)},xdrRequest=function(fullUrl,headers,cfg){log("sendRequest using XDomainRequest",LOG_SRC);var self=this,xhr,pairs=[],data,prop,until,control={finished:!1,fakeStatus:null},err;if(cfg.expectMultipart)return err=new Error("Attachment support not available"),void 0!==cfg.callback&&cfg.callback(err,null),{err:err,xhr:null};for(prop in fullUrl+="?method="+cfg.method,cfg.params)cfg.params.hasOwnProperty(prop)&&pairs.push(prop+"="+encodeURIComponent(cfg.params[prop]));for(prop in headers)headers.hasOwnProperty(prop)&&pairs.push(prop+"="+encodeURIComponent(headers[prop]));void 0!==cfg.data&&pairs.push("content="+encodeURIComponent(cfg.data)),data=pairs.join("&"),(xhr=new XDomainRequest).open("POST",fullUrl),cfg.callback?(xhr.onload=function(){control.fakeStatus=200,requestComplete.call(self,xhr,cfg,control)},xhr.onerror=function(){control.fakeStatus=400,requestComplete.call(self,xhr,cfg,control)},xhr.ontimeout=function(){control.fakeStatus=0,requestComplete.call(self,xhr,cfg,control)}):(xhr.onload=function(){control.fakeStatus=200},xhr.onerror=function(){control.fakeStatus=400},xhr.ontimeout=function(){control.fakeStatus=0}),xhr.onprogress=function(){},xhr.timeout=0;try{xhr.send(data)}catch(ex){log("sendRequest caught send exception: "+ex,LOG_SRC)}if(!cfg.callback){for(until=1e4+Date.now(),log("sendRequest - until: "+until+", finished: "+control.finished,LOG_SRC);Date.now()<until&&null===control.fakeStatus;)__delay();return requestComplete.call(self,xhr,cfg,control)}return xhr},TinCan.LRS.prototype._initByEnvironment=function(cfg){var urlParts,schemeMatches,locationPort,isXD;if(log("_initByEnvironment",LOG_SRC),cfg=cfg||{},this._makeRequest=nativeRequest,this._IEModeConversion=__IEModeConversion,null===(urlParts=this.endpoint.toLowerCase().match(/([A-Za-z]+:)\/\/([^:\/]+):?(\d+)?(\/.*)?$/)))throw log("[error] LRS invalid: failed to divide URL parts",LOG_SRC),{code:4,mesg:"LRS invalid: failed to divide URL parts"};if(locationPort=location.port,schemeMatches=location.protocol.toLowerCase()===urlParts[1],""===locationPort&&(locationPort="http:"===location.protocol.toLowerCase()?"80":"https:"===location.protocol.toLowerCase()?"443":""),isXD=!schemeMatches||location.hostname.toLowerCase()!==urlParts[2]||locationPort!==(null!==urlParts[3]&&void 0!==urlParts[3]&&""!==urlParts[3]?urlParts[3]:"http:"===urlParts[1]?"80":"https:"===urlParts[1]?"443":""))if(env.hasCORS){if(env.useXDR&&schemeMatches)this._makeRequest=xdrRequest;else if(env.useXDR&&!schemeMatches){if(!cfg.allowFail)throw log("[error] LRS invalid: cross domain request for differing scheme in IE with XDR",LOG_SRC),{code:2,mesg:"LRS invalid: cross domain request for differing scheme in IE with XDR"};log("[warning] LRS invalid: cross domain request for differing scheme in IE with XDR (allowed to fail)",LOG_SRC)}}else{if(!cfg.allowFail)throw log("[error] LRS invalid: cross domain requests not supported in this browser",LOG_SRC),{code:1,mesg:"LRS invalid: cross domain requests not supported in this browser"};log("[warning] LRS invalid: cross domain requests not supported in this browser (allowed to fail)",LOG_SRC)}},__delay=function(){var xhr=new XMLHttpRequest,url=window.location+"?forcenocache="+TinCan.Utils.getUUID();xhr.open("GET",url,!1),xhr.send(null)},TinCan.LRS.syncEnabled=!0,TinCan.LRS.prototype._getMultipartRequestData=function(boundary,jsonContent,requestAttachments){var parts=[],i;for(parts.push(__createJSONSegment(boundary,jsonContent)),i=0;i<requestAttachments.length;i+=1)null!==requestAttachments[i].content&&parts.push(__createAttachmentSegment(boundary,requestAttachments[i].content,requestAttachments[i].sha2,requestAttachments[i].contentType));return parts.push("\r\n--"+boundary+"--\r\n"),new Blob(parts)},__createJSONSegment=function(boundary,jsonContent){var content=["--"+boundary,"Content-Type: application/json","",JSON.stringify(jsonContent)].join("\r\n");return content+="\r\n"},__createAttachmentSegment=function(boundary,content,sha2,contentType){var blobParts=[],header=["--"+boundary,"Content-Type: "+contentType,"Content-Transfer-Encoding: binary","X-Experience-API-Hash: "+sha2].join("\r\n");return header+="\r\n\r\n",blobParts.push(header),blobParts.push(content),new Blob(blobParts)},TinCan.Utils.stringToArrayBuffer=function(content,encoding){var encoder;return encoding||(encoding=TinCan.Utils.defaultEncoding),(encoder=new TextEncoder(encoding)).encode(content).buffer},TinCan.Utils.stringFromArrayBuffer=function(content,encoding){var decoder;return encoding||(encoding=TinCan.Utils.defaultEncoding),(decoder=new TextDecoder(encoding)).decode(content)}):log("'window' not defined",LOG_SRC)}(),function(global){"use strict";var undefined=void 0,MAX_ARRAY_LENGTH=1e5;function Type(v){switch(typeof v){case"undefined":return"undefined";case"boolean":return"boolean";case"number":return"number";case"string":return"string";default:return null===v?"null":"object"}}function Class(v){return Object.prototype.toString.call(v).replace(/^\[object *|\]$/g,"")}function IsCallable(o){return"function"==typeof o}function ToObject(v){if(null===v||v===undefined)throw TypeError();return Object(v)}function ToInt32(v){return v>>0}function ToUint32(v){return v>>>0}var LN2=Math.LN2,abs=Math.abs,floor=Math.floor,log=Math.log,max=Math.max,min=Math.min,pow=Math.pow,round=Math.round,orig,dom_only;function makeArrayAccessors(obj){if(!("TYPED_ARRAY_POLYFILL_NO_ARRAY_ACCESSORS"in global)){if(obj.length>MAX_ARRAY_LENGTH)throw RangeError("Array too large for polyfill");var i;for(i=0;i<obj.length;i+=1)makeArrayAccessor(i)}function makeArrayAccessor(index){Object.defineProperty(obj,index,{get:function(){return obj._getter(index)},set:function(v){obj._setter(index,v)},enumerable:!0,configurable:!1})}}function as_signed(value,bits){var s=32-bits;return value<<s>>s}function as_unsigned(value,bits){var s=32-bits;return value<<s>>>s}function packI8(n){return[255&n]}function unpackI8(bytes){return as_signed(bytes[0],8)}function packU8(n){return[255&n]}function unpackU8(bytes){return as_unsigned(bytes[0],8)}function packU8Clamped(n){return[(n=round(Number(n)))<0?0:n>255?255:255&n]}function packI16(n){return[255&n,n>>8&255]}function unpackI16(bytes){return as_signed(bytes[1]<<8|bytes[0],16)}function packU16(n){return[255&n,n>>8&255]}function unpackU16(bytes){return as_unsigned(bytes[1]<<8|bytes[0],16)}function packI32(n){return[255&n,n>>8&255,n>>16&255,n>>24&255]}function unpackI32(bytes){return as_signed(bytes[3]<<24|bytes[2]<<16|bytes[1]<<8|bytes[0],32)}function packU32(n){return[255&n,n>>8&255,n>>16&255,n>>24&255]}function unpackU32(bytes){return as_unsigned(bytes[3]<<24|bytes[2]<<16|bytes[1]<<8|bytes[0],32)}function packIEEE754(v,ebits,fbits){var bias=(1<<ebits-1)-1,s,e,f;function roundToEven(n){var w=floor(n),f=n-w;return f<.5?w:f>.5?w+1:w%2?w+1:w}if(v!=v)e=(1<<ebits)-1,f=pow(2,fbits-1),s=0;else if(v===1/0||v===-1/0)e=(1<<ebits)-1,f=0,s=v<0?1:0;else if(0===v)e=0,f=0,s=1/v==-1/0?1:0;else if(s=v<0,(v=abs(v))>=pow(2,1-bias)){e=min(floor(log(v)/LN2),1023);var significand=v/pow(2,e);significand<1&&(e-=1,significand*=2),significand>=2&&(e+=1,significand/=2);var d=pow(2,fbits);e+=bias,(f=roundToEven(significand*d)-d)/d>=1&&(e+=1,f=0),e>2*bias&&(e=(1<<ebits)-1,f=0)}else e=0,f=roundToEven(v/pow(2,1-bias-fbits));var bits=[],i;for(i=fbits;i;i-=1)bits.push(f%2?1:0),f=floor(f/2);for(i=ebits;i;i-=1)bits.push(e%2?1:0),e=floor(e/2);bits.push(s?1:0),bits.reverse();for(var str=bits.join(""),bytes=[];str.length;)bytes.unshift(parseInt(str.substring(0,8),2)),str=str.substring(8);return bytes}function unpackIEEE754(bytes,ebits,fbits){var bits=[],i,j,b,str,bias,s,e,f;for(i=0;i<bytes.length;++i)for(b=bytes[i],j=8;j;j-=1)bits.push(b%2?1:0),b>>=1;return bits.reverse(),str=bits.join(""),bias=(1<<ebits-1)-1,s=parseInt(str.substring(0,1),2)?-1:1,e=parseInt(str.substring(1,1+ebits),2),f=parseInt(str.substring(1+ebits),2),e===(1<<ebits)-1?0!==f?NaN:s*(1/0):e>0?s*pow(2,e-bias)*(1+f/pow(2,fbits)):0!==f?s*pow(2,-(bias-1))*(f/pow(2,fbits)):s<0?-0:0}function unpackF64(b){return unpackIEEE754(b,11,52)}function packF64(v){return packIEEE754(v,11,52)}function unpackF32(b){return unpackIEEE754(b,8,23)}function packF32(v){return packIEEE754(v,8,23)}orig=Object.defineProperty,dom_only=!function(){try{return Object.defineProperty({},"x",{})}catch(_){return!1}}(),orig&&!dom_only||(Object.defineProperty=function(o,prop,desc){if(orig)try{return orig(o,prop,desc)}catch(_){}if(o!==Object(o))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in desc&&Object.prototype.__defineGetter__.call(o,prop,desc.get),Object.prototype.__defineSetter__&&"set"in desc&&Object.prototype.__defineSetter__.call(o,prop,desc.set),"value"in desc&&(o[prop]=desc.value),o}),function(){function ArrayBuffer(length){if((length=ToInt32(length))<0)throw RangeError("ArrayBuffer size is not a small enough positive integer.");Object.defineProperty(this,"byteLength",{value:length}),Object.defineProperty(this,"_bytes",{value:Array(length)});for(var i=0;i<length;i+=1)this._bytes[i]=0}function $TypedArray$(){if(!arguments.length||"object"!=typeof arguments[0])return function(length){if((length=ToInt32(length))<0)throw RangeError("length is not a small enough positive integer.");Object.defineProperty(this,"length",{value:length}),Object.defineProperty(this,"byteLength",{value:length*this.BYTES_PER_ELEMENT}),Object.defineProperty(this,"buffer",{value:new ArrayBuffer(this.byteLength)}),Object.defineProperty(this,"byteOffset",{value:0})}.apply(this,arguments);if(arguments.length>=1&&"object"===Type(arguments[0])&&arguments[0]instanceof $TypedArray$)return function(typedArray){if(this.constructor!==typedArray.constructor)throw TypeError();var byteLength=typedArray.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new ArrayBuffer(byteLength)}),Object.defineProperty(this,"byteLength",{value:byteLength}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:typedArray.length});for(var i=0;i<this.length;i+=1)this._setter(i,typedArray._getter(i))}.apply(this,arguments);if(arguments.length>=1&&"object"===Type(arguments[0])&&!(arguments[0]instanceof $TypedArray$)&&!(arguments[0]instanceof ArrayBuffer||"ArrayBuffer"===Class(arguments[0])))return function(array){var byteLength=array.length*this.BYTES_PER_ELEMENT;Object.defineProperty(this,"buffer",{value:new ArrayBuffer(byteLength)}),Object.defineProperty(this,"byteLength",{value:byteLength}),Object.defineProperty(this,"byteOffset",{value:0}),Object.defineProperty(this,"length",{value:array.length});for(var i=0;i<this.length;i+=1){var s=array[i];this._setter(i,Number(s))}}.apply(this,arguments);if(arguments.length>=1&&"object"===Type(arguments[0])&&(arguments[0]instanceof ArrayBuffer||"ArrayBuffer"===Class(arguments[0])))return function(buffer,byteOffset,length){if((byteOffset=ToUint32(byteOffset))>buffer.byteLength)throw RangeError("byteOffset out of range");if(byteOffset%this.BYTES_PER_ELEMENT)throw RangeError("buffer length minus the byteOffset is not a multiple of the element size.");if(length===undefined){var byteLength=buffer.byteLength-byteOffset;if(byteLength%this.BYTES_PER_ELEMENT)throw RangeError("length of buffer minus byteOffset not a multiple of the element size");length=byteLength/this.BYTES_PER_ELEMENT}else byteLength=(length=ToUint32(length))*this.BYTES_PER_ELEMENT;if(byteOffset+byteLength>buffer.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:buffer}),Object.defineProperty(this,"byteLength",{value:byteLength}),Object.defineProperty(this,"byteOffset",{value:byteOffset}),Object.defineProperty(this,"length",{value:length})}.apply(this,arguments);throw TypeError()}global.ArrayBuffer=global.ArrayBuffer||ArrayBuffer,Object.defineProperty($TypedArray$,"from",{value:function(iterable){return new this(iterable)}}),Object.defineProperty($TypedArray$,"of",{value:function(){return new this(arguments)}});var $TypedArrayPrototype$={};function makeTypedArray(elementSize,pack,unpack){var TypedArray=function(){Object.defineProperty(this,"constructor",{value:TypedArray}),$TypedArray$.apply(this,arguments),makeArrayAccessors(this)};"__proto__"in TypedArray?TypedArray.__proto__=$TypedArray$:(TypedArray.from=$TypedArray$.from,TypedArray.of=$TypedArray$.of),TypedArray.BYTES_PER_ELEMENT=elementSize;var TypedArrayPrototype=function(){};return TypedArrayPrototype.prototype=$TypedArrayPrototype$,TypedArray.prototype=new TypedArrayPrototype,Object.defineProperty(TypedArray.prototype,"BYTES_PER_ELEMENT",{value:elementSize}),Object.defineProperty(TypedArray.prototype,"_pack",{value:pack}),Object.defineProperty(TypedArray.prototype,"_unpack",{value:unpack}),TypedArray}$TypedArray$.prototype=$TypedArrayPrototype$,Object.defineProperty($TypedArray$.prototype,"_getter",{value:function(index){if(arguments.length<1)throw SyntaxError("Not enough arguments");if((index=ToUint32(index))>=this.length)return undefined;var bytes=[],i,o;for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1)bytes.push(this.buffer._bytes[o]);return this._unpack(bytes)}}),Object.defineProperty($TypedArray$.prototype,"get",{value:$TypedArray$.prototype._getter}),Object.defineProperty($TypedArray$.prototype,"_setter",{value:function(index,value){if(arguments.length<2)throw SyntaxError("Not enough arguments");if(!((index=ToUint32(index))>=this.length)){var bytes=this._pack(value),i,o;for(i=0,o=this.byteOffset+index*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,o+=1)this.buffer._bytes[o]=bytes[i]}}}),Object.defineProperty($TypedArray$.prototype,"constructor",{value:$TypedArray$}),Object.defineProperty($TypedArray$.prototype,"copyWithin",{value:function(target,start){var end=arguments[2],o=ToObject(this),lenVal,len=ToUint32(o.length);len=max(len,0);var relativeTarget=ToInt32(target),to;to=relativeTarget<0?max(len+relativeTarget,0):min(relativeTarget,len);var relativeStart=ToInt32(start),from,relativeEnd,final;from=relativeStart<0?max(len+relativeStart,0):min(relativeStart,len),final=(relativeEnd=end===undefined?len:ToInt32(end))<0?max(len+relativeEnd,0):min(relativeEnd,len);var count=min(final-from,len-to),direction;for(from<to&&to<from+count?(direction=-1,from=from+count-1,to=to+count-1):direction=1;count>0;)o._setter(to,o._getter(from)),from+=direction,to+=direction,count-=1;return o}}),Object.defineProperty($TypedArray$.prototype,"every",{value:function(callbackfn){if(this===undefined||null===this)throw TypeError();var t=Object(this),len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();for(var thisArg=arguments[1],i=0;i<len;i++)if(!callbackfn.call(thisArg,t._getter(i),i,t))return!1;return!0}}),Object.defineProperty($TypedArray$.prototype,"fill",{value:function(value){var start=arguments[1],end=arguments[2],o=ToObject(this),lenVal,len=ToUint32(o.length);len=max(len,0);var relativeStart=ToInt32(start),k,relativeEnd,final;for(k=relativeStart<0?max(len+relativeStart,0):min(relativeStart,len),final=(relativeEnd=end===undefined?len:ToInt32(end))<0?max(len+relativeEnd,0):min(relativeEnd,len);k<final;)o._setter(k,value),k+=1;return o}}),Object.defineProperty($TypedArray$.prototype,"filter",{value:function(callbackfn){if(this===undefined||null===this)throw TypeError();var t=Object(this),len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();for(var res=[],thisp=arguments[1],i=0;i<len;i++){var val=t._getter(i);callbackfn.call(thisp,val,i,t)&&res.push(val)}return new this.constructor(res)}}),Object.defineProperty($TypedArray$.prototype,"find",{value:function(predicate){var o=ToObject(this),lenValue,len=ToUint32(o.length);if(!IsCallable(predicate))throw TypeError();for(var t=arguments.length>1?arguments[1]:undefined,k=0;k<len;){var kValue=o._getter(k),testResult=predicate.call(t,kValue,k,o);if(Boolean(testResult))return kValue;++k}return undefined}}),Object.defineProperty($TypedArray$.prototype,"findIndex",{value:function(predicate){var o=ToObject(this),lenValue,len=ToUint32(o.length);if(!IsCallable(predicate))throw TypeError();for(var t=arguments.length>1?arguments[1]:undefined,k=0;k<len;){var kValue=o._getter(k),testResult=predicate.call(t,kValue,k,o);if(Boolean(testResult))return k;++k}return-1}}),Object.defineProperty($TypedArray$.prototype,"forEach",{value:function(callbackfn){if(this===undefined||null===this)throw TypeError();var t=Object(this),len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();for(var thisp=arguments[1],i=0;i<len;i++)callbackfn.call(thisp,t._getter(i),i,t)}}),Object.defineProperty($TypedArray$.prototype,"indexOf",{value:function(searchElement){if(this===undefined||null===this)throw TypeError();var t=Object(this),len=ToUint32(t.length);if(0===len)return-1;var n=0;if(arguments.length>0&&((n=Number(arguments[1]))!=n?n=0:0!==n&&n!==1/0&&n!==-1/0&&(n=(n>0||-1)*floor(abs(n)))),n>=len)return-1;for(var k=n>=0?n:max(len-abs(n),0);k<len;k++)if(t._getter(k)===searchElement)return k;return-1}}),Object.defineProperty($TypedArray$.prototype,"join",{value:function(separator){if(this===undefined||null===this)throw TypeError();for(var t=Object(this),len=ToUint32(t.length),tmp=Array(len),i=0;i<len;++i)tmp[i]=t._getter(i);return tmp.join(separator===undefined?",":separator)}}),Object.defineProperty($TypedArray$.prototype,"lastIndexOf",{value:function(searchElement){if(this===undefined||null===this)throw TypeError();var t=Object(this),len=ToUint32(t.length);if(0===len)return-1;var n=len;arguments.length>1&&((n=Number(arguments[1]))!=n?n=0:0!==n&&n!==1/0&&n!==-1/0&&(n=(n>0||-1)*floor(abs(n))));for(var k=n>=0?min(n,len-1):len-abs(n);k>=0;k--)if(t._getter(k)===searchElement)return k;return-1}}),Object.defineProperty($TypedArray$.prototype,"map",{value:function(callbackfn){if(this===undefined||null===this)throw TypeError();var t=Object(this),len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();var res=[];res.length=len;for(var thisp=arguments[1],i=0;i<len;i++)res[i]=callbackfn.call(thisp,t._getter(i),i,t);return new this.constructor(res)}}),Object.defineProperty($TypedArray$.prototype,"reduce",{value:function(callbackfn){if(this===undefined||null===this)throw TypeError();var t=Object(this),len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();if(0===len&&1===arguments.length)throw TypeError();var k=0,accumulator;for(accumulator=arguments.length>=2?arguments[1]:t._getter(k++);k<len;)accumulator=callbackfn.call(undefined,accumulator,t._getter(k),k,t),k++;return accumulator}}),Object.defineProperty($TypedArray$.prototype,"reduceRight",{value:function(callbackfn){if(this===undefined||null===this)throw TypeError();var t=Object(this),len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();if(0===len&&1===arguments.length)throw TypeError();var k=len-1,accumulator;for(accumulator=arguments.length>=2?arguments[1]:t._getter(k--);k>=0;)accumulator=callbackfn.call(undefined,accumulator,t._getter(k),k,t),k--;return accumulator}}),Object.defineProperty($TypedArray$.prototype,"reverse",{value:function(){if(this===undefined||null===this)throw TypeError();for(var t=Object(this),len=ToUint32(t.length),half=floor(len/2),i=0,j=len-1;i<half;++i,--j){var tmp=t._getter(i);t._setter(i,t._getter(j)),t._setter(j,tmp)}return t}}),Object.defineProperty($TypedArray$.prototype,"set",{value:function(index,value){if(arguments.length<1)throw SyntaxError("Not enough arguments");var array,sequence,offset,len,i,s,d,byteOffset,byteLength,tmp;if("object"==typeof arguments[0]&&arguments[0].constructor===this.constructor){if(array=arguments[0],(offset=ToUint32(arguments[1]))+array.length>this.length)throw RangeError("Offset plus length of array is out of range");if(byteOffset=this.byteOffset+offset*this.BYTES_PER_ELEMENT,byteLength=array.length*this.BYTES_PER_ELEMENT,array.buffer===this.buffer){for(tmp=[],i=0,s=array.byteOffset;i<byteLength;i+=1,s+=1)tmp[i]=array.buffer._bytes[s];for(i=0,d=byteOffset;i<byteLength;i+=1,d+=1)this.buffer._bytes[d]=tmp[i]}else for(i=0,s=array.byteOffset,d=byteOffset;i<byteLength;i+=1,s+=1,d+=1)this.buffer._bytes[d]=array.buffer._bytes[s]}else{if("object"!=typeof arguments[0]||void 0===arguments[0].length)throw TypeError("Unexpected argument type(s)");if(len=ToUint32((sequence=arguments[0]).length),(offset=ToUint32(arguments[1]))+len>this.length)throw RangeError("Offset plus length of array is out of range");for(i=0;i<len;i+=1)s=sequence[i],this._setter(offset+i,Number(s))}}}),Object.defineProperty($TypedArray$.prototype,"slice",{value:function(start,end){for(var o=ToObject(this),lenVal,len=ToUint32(o.length),relativeStart=ToInt32(start),k=relativeStart<0?max(len+relativeStart,0):min(relativeStart,len),relativeEnd=end===undefined?len:ToInt32(end),final=relativeEnd<0?max(len+relativeEnd,0):min(relativeEnd,len),count=final-k,c,a=new(0,o.constructor)(count),n=0;k<final;){var kValue=o._getter(k);a._setter(n,kValue),++k,++n}return a}}),Object.defineProperty($TypedArray$.prototype,"some",{value:function(callbackfn){if(this===undefined||null===this)throw TypeError();var t=Object(this),len=ToUint32(t.length);if(!IsCallable(callbackfn))throw TypeError();for(var thisp=arguments[1],i=0;i<len;i++)if(callbackfn.call(thisp,t._getter(i),i,t))return!0;return!1}}),Object.defineProperty($TypedArray$.prototype,"sort",{value:function(comparefn){if(this===undefined||null===this)throw TypeError();for(var t=Object(this),len=ToUint32(t.length),tmp=Array(len),i=0;i<len;++i)tmp[i]=t._getter(i);for(comparefn?tmp.sort(comparefn):tmp.sort(),i=0;i<len;++i)t._setter(i,tmp[i]);return t}}),Object.defineProperty($TypedArray$.prototype,"subarray",{value:function(start,end){function clamp(v,min,max){return v<min?min:v>max?max:v}start=ToInt32(start),end=ToInt32(end),arguments.length<1&&(start=0),arguments.length<2&&(end=this.length),start<0&&(start=this.length+start),end<0&&(end=this.length+end),start=clamp(start,0,this.length);var len=(end=clamp(end,0,this.length))-start;return len<0&&(len=0),new this.constructor(this.buffer,this.byteOffset+start*this.BYTES_PER_ELEMENT,len)}});var Int8Array=makeTypedArray(1,packI8,unpackI8),Uint8Array=makeTypedArray(1,packU8,unpackU8),Uint8ClampedArray=makeTypedArray(1,packU8Clamped,unpackU8),Int16Array=makeTypedArray(2,packI16,unpackI16),Uint16Array=makeTypedArray(2,packU16,unpackU16),Int32Array=makeTypedArray(4,packI32,unpackI32),Uint32Array=makeTypedArray(4,packU32,unpackU32),Float32Array=makeTypedArray(4,packF32,unpackF32),Float64Array=makeTypedArray(8,packF64,unpackF64);global.Int8Array=global.Int8Array||Int8Array,global.Uint8Array=global.Uint8Array||Uint8Array,global.Uint8ClampedArray=global.Uint8ClampedArray||Uint8ClampedArray,global.Int16Array=global.Int16Array||Int16Array,global.Uint16Array=global.Uint16Array||Uint16Array,global.Int32Array=global.Int32Array||Int32Array,global.Uint32Array=global.Uint32Array||Uint32Array,global.Float32Array=global.Float32Array||Float32Array,global.Float64Array=global.Float64Array||Float64Array}(),function(){function r(array,index){return IsCallable(array.get)?array.get(index):array[index]}var IS_BIG_ENDIAN=(u16array=new Uint16Array([4660]),18===r(new Uint8Array(u16array.buffer),0)),u16array,u8array;function DataView(buffer,byteOffset,byteLength){if(!(buffer instanceof ArrayBuffer||"ArrayBuffer"===Class(buffer)))throw TypeError();if((byteOffset=ToUint32(byteOffset))>buffer.byteLength)throw RangeError("byteOffset out of range");if(byteOffset+(byteLength=byteLength===undefined?buffer.byteLength-byteOffset:ToUint32(byteLength))>buffer.byteLength)throw RangeError("byteOffset and length reference an area beyond the end of the buffer");Object.defineProperty(this,"buffer",{value:buffer}),Object.defineProperty(this,"byteLength",{value:byteLength}),Object.defineProperty(this,"byteOffset",{value:byteOffset})}function makeGetter(arrayType){return function GetViewValue(byteOffset,littleEndian){if((byteOffset=ToUint32(byteOffset))+arrayType.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");byteOffset+=this.byteOffset;for(var uint8Array=new Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT),bytes=[],i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1)bytes.push(r(uint8Array,i));return Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN)&&bytes.reverse(),r(new arrayType(new Uint8Array(bytes).buffer),0)}}function makeSetter(arrayType){return function SetViewValue(byteOffset,value,littleEndian){if((byteOffset=ToUint32(byteOffset))+arrayType.BYTES_PER_ELEMENT>this.byteLength)throw RangeError("Array index out of range");var typeArray=new arrayType([value]),byteArray=new Uint8Array(typeArray.buffer),bytes=[],i,byteView;for(i=0;i<arrayType.BYTES_PER_ELEMENT;i+=1)bytes.push(r(byteArray,i));Boolean(littleEndian)===Boolean(IS_BIG_ENDIAN)&&bytes.reverse(),(byteView=new Uint8Array(this.buffer,byteOffset,arrayType.BYTES_PER_ELEMENT)).set(bytes)}}Object.defineProperty(DataView.prototype,"getUint8",{value:makeGetter(Uint8Array)}),Object.defineProperty(DataView.prototype,"getInt8",{value:makeGetter(Int8Array)}),Object.defineProperty(DataView.prototype,"getUint16",{value:makeGetter(Uint16Array)}),Object.defineProperty(DataView.prototype,"getInt16",{value:makeGetter(Int16Array)}),Object.defineProperty(DataView.prototype,"getUint32",{value:makeGetter(Uint32Array)}),Object.defineProperty(DataView.prototype,"getInt32",{value:makeGetter(Int32Array)}),Object.defineProperty(DataView.prototype,"getFloat32",{value:makeGetter(Float32Array)}),Object.defineProperty(DataView.prototype,"getFloat64",{value:makeGetter(Float64Array)}),Object.defineProperty(DataView.prototype,"setUint8",{value:makeSetter(Uint8Array)}),Object.defineProperty(DataView.prototype,"setInt8",{value:makeSetter(Int8Array)}),Object.defineProperty(DataView.prototype,"setUint16",{value:makeSetter(Uint16Array)}),Object.defineProperty(DataView.prototype,"setInt16",{value:makeSetter(Int16Array)}),Object.defineProperty(DataView.prototype,"setUint32",{value:makeSetter(Uint32Array)}),Object.defineProperty(DataView.prototype,"setInt32",{value:makeSetter(Int32Array)}),Object.defineProperty(DataView.prototype,"setFloat32",{value:makeSetter(Float32Array)}),Object.defineProperty(DataView.prototype,"setFloat64",{value:makeSetter(Float64Array)}),global.DataView=global.DataView||DataView}()}(self),function(undefined){"use strict";function clamp(val,length){return(val=0|val||0)<0?Math.max(val+length,0):Math.min(val,length)}ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(from,to){var length=this.byteLength,begin=clamp(from,length),end=length;if(void 0!==to&&(end=clamp(to,length)),begin>end)return new ArrayBuffer(0);var num=end-begin,target=new ArrayBuffer(num),targetArray=new Uint8Array(target),sourceArray=new Uint8Array(this,begin,num);return targetArray.set(sourceArray),target})}(),"undefined"!=typeof module&&module.exports&&(this["encoding-indexes"]=require("./encoding-indexes.js")["encoding-indexes"]),function(global){"use strict";function inRange(a,min,max){return min<=a&&a<=max}function includes(array,item){return-1!==array.indexOf(item)}var floor=Math.floor;function ToDictionary(o){if(void 0===o)return{};if(o===Object(o))return o;throw TypeError("Could not convert argument to dictionary")}function stringToCodePoints(string){for(var s=String(string),n=s.length,i=0,u=[];i<n;){var c=s.charCodeAt(i);if(c<55296||c>57343)u.push(c);else if(56320<=c&&c<=57343)u.push(65533);else if(55296<=c&&c<=56319)if(i===n-1)u.push(65533);else{var d=string.charCodeAt(i+1);if(56320<=d&&d<=57343){var a=1023&c,b=1023&d;u.push(65536+(a<<10)+b),i+=1}else u.push(65533)}i+=1}return u}function codePointsToString(code_points){for(var s="",i=0;i<code_points.length;++i){var cp=code_points[i];cp<=65535?s+=String.fromCharCode(cp):(cp-=65536,s+=String.fromCharCode(55296+(cp>>10),56320+(1023&cp)))}return s}function isASCIIByte(a){return 0<=a&&a<=127}var isASCIICodePoint=isASCIIByte,end_of_stream=-1;function Stream(tokens){this.tokens=[].slice.call(tokens),this.tokens.reverse()}Stream.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.pop():end_of_stream},prepend:function(token){if(Array.isArray(token))for(var tokens=token;tokens.length;)this.tokens.push(tokens.pop());else this.tokens.push(token)},push:function(token){if(Array.isArray(token))for(var tokens=token;tokens.length;)this.tokens.unshift(tokens.shift());else this.tokens.unshift(token)}};var finished=-1;function decoderError(fatal,opt_code_point){if(fatal)throw TypeError("Decoder error");return opt_code_point||65533}function encoderError(code_point){throw TypeError("The code point "+code_point+" could not be encoded.")}function Decoder(){}function Encoder(){}function getEncoding(label){return label=String(label).trim().toLowerCase(),Object.prototype.hasOwnProperty.call(label_to_encoding,label)?label_to_encoding[label]:null}Decoder.prototype={handler:function(stream,bite){}},Encoder.prototype={handler:function(stream,code_point){}};var encodings=[{encodings:[{labels:["unicode-1-1-utf-8","utf-8","utf8"],name:"UTF-8"}],heading:"The Encoding"},{encodings:[{labels:["866","cp866","csibm866","ibm866"],name:"IBM866"},{labels:["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso88592","iso_8859-2","iso_8859-2:1987","l2","latin2"],name:"ISO-8859-2"},{labels:["csisolatin3","iso-8859-3","iso-ir-109","iso8859-3","iso88593","iso_8859-3","iso_8859-3:1988","l3","latin3"],name:"ISO-8859-3"},{labels:["csisolatin4","iso-8859-4","iso-ir-110","iso8859-4","iso88594","iso_8859-4","iso_8859-4:1988","l4","latin4"],name:"ISO-8859-4"},{labels:["csisolatincyrillic","cyrillic","iso-8859-5","iso-ir-144","iso8859-5","iso88595","iso_8859-5","iso_8859-5:1988"],name:"ISO-8859-5"},{labels:["arabic","asmo-708","csiso88596e","csiso88596i","csisolatinarabic","ecma-114","iso-8859-6","iso-8859-6-e","iso-8859-6-i","iso-ir-127","iso8859-6","iso88596","iso_8859-6","iso_8859-6:1987"],name:"ISO-8859-6"},{labels:["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso-ir-126","iso8859-7","iso88597","iso_8859-7","iso_8859-7:1987","sun_eu_greek"],name:"ISO-8859-7"},{labels:["csiso88598e","csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-e","iso-ir-138","iso8859-8","iso88598","iso_8859-8","iso_8859-8:1988","visual"],name:"ISO-8859-8"},{labels:["csiso88598i","iso-8859-8-i","logical"],name:"ISO-8859-8-I"},{labels:["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","iso885910","l6","latin6"],name:"ISO-8859-10"},{labels:["iso-8859-13","iso8859-13","iso885913"],name:"ISO-8859-13"},{labels:["iso-8859-14","iso8859-14","iso885914"],name:"ISO-8859-14"},{labels:["csisolatin9","iso-8859-15","iso8859-15","iso885915","iso_8859-15","l9"],name:"ISO-8859-15"},{labels:["iso-8859-16"],name:"ISO-8859-16"},{labels:["cskoi8r","koi","koi8","koi8-r","koi8_r"],name:"KOI8-R"},{labels:["koi8-ru","koi8-u"],name:"KOI8-U"},{labels:["csmacintosh","mac","macintosh","x-mac-roman"],name:"macintosh"},{labels:["dos-874","iso-8859-11","iso8859-11","iso885911","tis-620","windows-874"],name:"windows-874"},{labels:["cp1250","windows-1250","x-cp1250"],name:"windows-1250"},{labels:["cp1251","windows-1251","x-cp1251"],name:"windows-1251"},{labels:["ansi_x3.4-1968","ascii","cp1252","cp819","csisolatin1","ibm819","iso-8859-1","iso-ir-100","iso8859-1","iso88591","iso_8859-1","iso_8859-1:1987","l1","latin1","us-ascii","windows-1252","x-cp1252"],name:"windows-1252"},{labels:["cp1253","windows-1253","x-cp1253"],name:"windows-1253"},{labels:["cp1254","csisolatin5","iso-8859-9","iso-ir-148","iso8859-9","iso88599","iso_8859-9","iso_8859-9:1989","l5","latin5","windows-1254","x-cp1254"],name:"windows-1254"},{labels:["cp1255","windows-1255","x-cp1255"],name:"windows-1255"},{labels:["cp1256","windows-1256","x-cp1256"],name:"windows-1256"},{labels:["cp1257","windows-1257","x-cp1257"],name:"windows-1257"},{labels:["cp1258","windows-1258","x-cp1258"],name:"windows-1258"},{labels:["x-mac-cyrillic","x-mac-ukrainian"],name:"x-mac-cyrillic"}],heading:"Legacy single-byte encodings"},{encodings:[{labels:["chinese","csgb2312","csiso58gb231280","gb2312","gb_2312","gb_2312-80","gbk","iso-ir-58","x-gbk"],name:"GBK"},{labels:["gb18030"],name:"gb18030"}],heading:"Legacy multi-byte Chinese (simplified) encodings"},{encodings:[{labels:["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],name:"Big5"}],heading:"Legacy multi-byte Chinese (traditional) encodings"},{encodings:[{labels:["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],name:"EUC-JP"},{labels:["csiso2022jp","iso-2022-jp"],name:"ISO-2022-JP"},{labels:["csshiftjis","ms932","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],name:"Shift_JIS"}],heading:"Legacy multi-byte Japanese encodings"},{encodings:[{labels:["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],name:"EUC-KR"}],heading:"Legacy multi-byte Korean encodings"},{encodings:[{labels:["csiso2022kr","hz-gb-2312","iso-2022-cn","iso-2022-cn-ext","iso-2022-kr"],name:"replacement"},{labels:["utf-16be"],name:"UTF-16BE"},{labels:["utf-16","utf-16le"],name:"UTF-16LE"},{labels:["x-user-defined"],name:"x-user-defined"}],heading:"Legacy miscellaneous encodings"}],label_to_encoding={};encodings.forEach(function(category){category.encodings.forEach(function(encoding){encoding.labels.forEach(function(label){label_to_encoding[label]=encoding})})});var encoders={},decoders={};function indexCodePointFor(pointer,index){return index&&index[pointer]||null}function indexPointerFor(code_point,index){var pointer=index.indexOf(code_point);return-1===pointer?null:pointer}function index(name){if(!("encoding-indexes"in global))throw Error("Indexes missing. Did you forget to include encoding-indexes.js?");return global["encoding-indexes"][name]}function indexGB18030RangesCodePointFor(pointer){if(pointer>39419&&pointer<189e3||pointer>1237575)return null;if(7457===pointer)return 59335;var offset=0,code_point_offset=0,idx=index("gb18030"),i;for(i=0;i<idx.length;++i){var entry=idx[i];if(!(entry[0]<=pointer))break;offset=entry[0],code_point_offset=entry[1]}return code_point_offset+pointer-offset}function indexGB18030RangesPointerFor(code_point){if(59335===code_point)return 7457;var offset=0,pointer_offset=0,idx=index("gb18030"),i;for(i=0;i<idx.length;++i){var entry=idx[i];if(!(entry[1]<=code_point))break;offset=entry[1],pointer_offset=entry[0]}return pointer_offset+code_point-offset}function indexShiftJISPointerFor(code_point){var pointer=indexPointerFor(code_point,index("jis0208"));return null===pointer||inRange(pointer,8272,8835)?null:pointer}function indexBig5PointerFor(code_point){var index_=index("big5");return 9552===code_point||9566===code_point||9569===code_point||9578===code_point||21313===code_point||21317===code_point?index_.lastIndexOf(code_point):indexPointerFor(code_point,index_)}var DEFAULT_ENCODING="utf-8";function TextDecoder(label,options){if(!(this instanceof TextDecoder))throw TypeError("Called as a function. Did you forget 'new'?");label=void 0!==label?String(label):DEFAULT_ENCODING,options=ToDictionary(options),this._encoding=null,this._decoder=null,this._ignoreBOM=!1,this._BOMseen=!1,this._error_mode="replacement",this._do_not_flush=!1;var encoding=getEncoding(label);if(null===encoding||"replacement"===encoding.name)throw RangeError("Unknown encoding: "+label);if(!decoders[encoding.name])throw Error("Decoder not present. Did you forget to include encoding-indexes.js?");var dec=this;return dec._encoding=encoding,Boolean(options.fatal)&&(dec._error_mode="fatal"),Boolean(options.ignoreBOM)&&(dec._ignoreBOM=!0),Object.defineProperty||(this.encoding=dec._encoding.name.toLowerCase(),this.fatal="fatal"===dec._error_mode,this.ignoreBOM=dec._ignoreBOM),dec}function TextEncoder(label,options){if(!(this instanceof TextEncoder))throw TypeError("Called as a function. Did you forget 'new'?");options=ToDictionary(options),this._encoding=null,this._encoder=null,this._do_not_flush=!1,this._fatal=Boolean(options.fatal)?"fatal":"replacement";var enc=this;if(Boolean(options.NONSTANDARD_allowLegacyEncoding)){var encoding=getEncoding(label=void 0!==label?String(label):DEFAULT_ENCODING);if(null===encoding||"replacement"===encoding.name)throw RangeError("Unknown encoding: "+label);if(!encoders[encoding.name])throw Error("Encoder not present. Did you forget to include encoding-indexes.js?");enc._encoding=encoding}else enc._encoding=getEncoding("utf-8"),void 0!==label&&"console"in global&&console.warn("TextEncoder constructor called with encoding label, which is ignored.");return Object.defineProperty||(this.encoding=enc._encoding.name.toLowerCase()),enc}function UTF8Decoder(options){var fatal=options.fatal,utf8_code_point=0,utf8_bytes_seen=0,utf8_bytes_needed=0,utf8_lower_boundary=128,utf8_upper_boundary=191;this.handler=function(stream,bite){if(bite===end_of_stream&&0!==utf8_bytes_needed)return utf8_bytes_needed=0,decoderError(fatal);if(bite===end_of_stream)return finished;if(0===utf8_bytes_needed){if(inRange(bite,0,127))return bite;if(inRange(bite,194,223))utf8_bytes_needed=1,utf8_code_point=bite-192;else if(inRange(bite,224,239))224===bite&&(utf8_lower_boundary=160),237===bite&&(utf8_upper_boundary=159),utf8_bytes_needed=2,utf8_code_point=bite-224;else{if(!inRange(bite,240,244))return decoderError(fatal);240===bite&&(utf8_lower_boundary=144),244===bite&&(utf8_upper_boundary=143),utf8_bytes_needed=3,utf8_code_point=bite-240}return utf8_code_point<<=6*utf8_bytes_needed,null}if(!inRange(bite,utf8_lower_boundary,utf8_upper_boundary))return utf8_code_point=utf8_bytes_needed=utf8_bytes_seen=0,utf8_lower_boundary=128,utf8_upper_boundary=191,stream.prepend(bite),decoderError(fatal);if(utf8_lower_boundary=128,utf8_upper_boundary=191,utf8_code_point+=bite-128<<6*(utf8_bytes_needed-(utf8_bytes_seen+=1)),utf8_bytes_seen!==utf8_bytes_needed)return null;var code_point=utf8_code_point;return utf8_code_point=utf8_bytes_needed=utf8_bytes_seen=0,code_point}}function UTF8Encoder(options){var fatal=options.fatal;this.handler=function(stream,code_point){if(code_point===end_of_stream)return finished;if(inRange(code_point,0,127))return code_point;var count,offset;inRange(code_point,128,2047)?(count=1,offset=192):inRange(code_point,2048,65535)?(count=2,offset=224):inRange(code_point,65536,1114111)&&(count=3,offset=240);for(var bytes=[(code_point>>6*count)+offset];count>0;){var temp=code_point>>6*(count-1);bytes.push(128|63&temp),count-=1}return bytes}}function SingleByteDecoder(index,options){var fatal=options.fatal;this.handler=function(stream,bite){if(bite===end_of_stream)return finished;if(isASCIIByte(bite))return bite;var code_point=index[bite-128];return null===code_point?decoderError(fatal):code_point}}function SingleByteEncoder(index,options){var fatal=options.fatal;this.handler=function(stream,code_point){if(code_point===end_of_stream)return finished;if(isASCIICodePoint(code_point))return code_point;var pointer=indexPointerFor(code_point,index);return null===pointer&&encoderError(code_point),pointer+128}}function GB18030Decoder(options){var fatal=options.fatal,gb18030_first=0,gb18030_second=0,gb18030_third=0;this.handler=function(stream,bite){if(bite===end_of_stream&&0===gb18030_first&&0===gb18030_second&&0===gb18030_third)return finished;var code_point;if(bite!==end_of_stream||0===gb18030_first&&0===gb18030_second&&0===gb18030_third||(gb18030_first=0,gb18030_second=0,gb18030_third=0,decoderError(fatal)),0!==gb18030_third){code_point=null,inRange(bite,48,57)&&(code_point=indexGB18030RangesCodePointFor(10*(126*(10*(gb18030_first-129)+(gb18030_second-48))+(gb18030_third-129))+bite-48));var buffer=[gb18030_second,gb18030_third,bite];return gb18030_first=0,gb18030_second=0,gb18030_third=0,null===code_point?(stream.prepend(buffer),decoderError(fatal)):code_point}if(0!==gb18030_second)return inRange(bite,129,254)?(gb18030_third=bite,null):(stream.prepend([gb18030_second,bite]),gb18030_first=0,gb18030_second=0,decoderError(fatal));if(0!==gb18030_first){if(inRange(bite,48,57))return gb18030_second=bite,null;var lead=gb18030_first,pointer=null;gb18030_first=0;var offset=bite<127?64:65;return(inRange(bite,64,126)||inRange(bite,128,254))&&(pointer=190*(lead-129)+(bite-offset)),null===(code_point=null===pointer?null:indexCodePointFor(pointer,index("gb18030")))&&isASCIIByte(bite)&&stream.prepend(bite),null===code_point?decoderError(fatal):code_point}return isASCIIByte(bite)?bite:128===bite?8364:inRange(bite,129,254)?(gb18030_first=bite,null):decoderError(fatal)}}function GB18030Encoder(options,gbk_flag){var fatal=options.fatal;this.handler=function(stream,code_point){if(code_point===end_of_stream)return finished;if(isASCIICodePoint(code_point))return code_point;if(58853===code_point)return encoderError(code_point);if(gbk_flag&&8364===code_point)return 128;var pointer=indexPointerFor(code_point,index("gb18030"));if(null!==pointer){var lead,trail=pointer%190,offset;return[floor(pointer/190)+129,trail+(trail<63?64:65)]}if(gbk_flag)return encoderError(code_point);pointer=indexGB18030RangesPointerFor(code_point);var byte1=floor(pointer/10/126/10),byte2=floor((pointer-=10*byte1*126*10)/10/126),byte3=floor((pointer-=10*byte2*126)/10),byte4;return[byte1+129,byte2+48,byte3+129,pointer-10*byte3+48]}}function Big5Decoder(options){var fatal=options.fatal,big5_lead=0;this.handler=function(stream,bite){if(bite===end_of_stream&&0!==big5_lead)return big5_lead=0,decoderError(fatal);if(bite===end_of_stream&&0===big5_lead)return finished;if(0!==big5_lead){var lead=big5_lead,pointer=null;big5_lead=0;var offset=bite<127?64:98;switch((inRange(bite,64,126)||inRange(bite,161,254))&&(pointer=157*(lead-129)+(bite-offset)),pointer){case 1133:return[202,772];case 1135:return[202,780];case 1164:return[234,772];case 1166:return[234,780]}var code_point=null===pointer?null:indexCodePointFor(pointer,index("big5"));return null===code_point&&isASCIIByte(bite)&&stream.prepend(bite),null===code_point?decoderError(fatal):code_point}return isASCIIByte(bite)?bite:inRange(bite,129,254)?(big5_lead=bite,null):decoderError(fatal)}}function Big5Encoder(options){var fatal=options.fatal;this.handler=function(stream,code_point){if(code_point===end_of_stream)return finished;if(isASCIICodePoint(code_point))return code_point;var pointer=indexBig5PointerFor(code_point);if(null===pointer)return encoderError(code_point);var lead=floor(pointer/157)+129;if(lead<161)return encoderError(code_point);var trail=pointer%157,offset;return[lead,trail+(trail<63?64:98)]}}function EUCJPDecoder(options){var fatal=options.fatal,eucjp_jis0212_flag=!1,eucjp_lead=0;this.handler=function(stream,bite){if(bite===end_of_stream&&0!==eucjp_lead)return eucjp_lead=0,decoderError(fatal);if(bite===end_of_stream&&0===eucjp_lead)return finished;if(142===eucjp_lead&&inRange(bite,161,223))return eucjp_lead=0,65377+bite-161;if(143===eucjp_lead&&inRange(bite,161,254))return eucjp_jis0212_flag=!0,eucjp_lead=bite,null;if(0!==eucjp_lead){var lead=eucjp_lead;eucjp_lead=0;var code_point=null;return inRange(lead,161,254)&&inRange(bite,161,254)&&(code_point=indexCodePointFor(94*(lead-161)+(bite-161),index(eucjp_jis0212_flag?"jis0212":"jis0208"))),eucjp_jis0212_flag=!1,inRange(bite,161,254)||stream.prepend(bite),null===code_point?decoderError(fatal):code_point}return isASCIIByte(bite)?bite:142===bite||143===bite||inRange(bite,161,254)?(eucjp_lead=bite,null):decoderError(fatal)}}function EUCJPEncoder(options){var fatal=options.fatal;this.handler=function(stream,code_point){if(code_point===end_of_stream)return finished;if(isASCIICodePoint(code_point))return code_point;if(165===code_point)return 92;if(8254===code_point)return 126;if(inRange(code_point,65377,65439))return[142,code_point-65377+161];8722===code_point&&(code_point=65293);var pointer=indexPointerFor(code_point,index("jis0208")),lead,trail;return null===pointer?encoderError(code_point):[floor(pointer/94)+161,pointer%94+161]}}function ISO2022JPDecoder(options){var fatal=options.fatal,states_ASCII=0,states_Roman=1,states_Katakana=2,states_LeadByte=3,states_TrailByte=4,states_EscapeStart=5,states_Escape=6,iso2022jp_decoder_state=states_ASCII,iso2022jp_decoder_output_state=states_ASCII,iso2022jp_lead=0,iso2022jp_output_flag=!1;this.handler=function(stream,bite){switch(iso2022jp_decoder_state){default:case states_ASCII:return 27===bite?(iso2022jp_decoder_state=states_EscapeStart,null):inRange(bite,0,127)&&14!==bite&&15!==bite&&27!==bite?(iso2022jp_output_flag=!1,bite):bite===end_of_stream?finished:(iso2022jp_output_flag=!1,decoderError(fatal));case states_Roman:return 27===bite?(iso2022jp_decoder_state=states_EscapeStart,null):92===bite?(iso2022jp_output_flag=!1,165):126===bite?(iso2022jp_output_flag=!1,8254):inRange(bite,0,127)&&14!==bite&&15!==bite&&27!==bite&&92!==bite&&126!==bite?(iso2022jp_output_flag=!1,bite):bite===end_of_stream?finished:(iso2022jp_output_flag=!1,decoderError(fatal));case states_Katakana:return 27===bite?(iso2022jp_decoder_state=states_EscapeStart,null):inRange(bite,33,95)?(iso2022jp_output_flag=!1,65377+bite-33):bite===end_of_stream?finished:(iso2022jp_output_flag=!1,decoderError(fatal));case states_LeadByte:return 27===bite?(iso2022jp_decoder_state=states_EscapeStart,null):inRange(bite,33,126)?(iso2022jp_output_flag=!1,iso2022jp_lead=bite,iso2022jp_decoder_state=states_TrailByte,null):bite===end_of_stream?finished:(iso2022jp_output_flag=!1,decoderError(fatal));case states_TrailByte:if(27===bite)return iso2022jp_decoder_state=states_EscapeStart,decoderError(fatal);if(inRange(bite,33,126)){iso2022jp_decoder_state=states_LeadByte;var pointer,code_point=indexCodePointFor(94*(iso2022jp_lead-33)+bite-33,index("jis0208"));return null===code_point?decoderError(fatal):code_point}return bite===end_of_stream?(iso2022jp_decoder_state=states_LeadByte,stream.prepend(bite),decoderError(fatal)):(iso2022jp_decoder_state=states_LeadByte,decoderError(fatal));case states_EscapeStart:return 36===bite||40===bite?(iso2022jp_lead=bite,iso2022jp_decoder_state=states_Escape,null):(stream.prepend(bite),iso2022jp_output_flag=!1,iso2022jp_decoder_state=iso2022jp_decoder_output_state,decoderError(fatal));case states_Escape:var lead=iso2022jp_lead;iso2022jp_lead=0;var state=null;if(40===lead&&66===bite&&(state=states_ASCII),40===lead&&74===bite&&(state=states_Roman),40===lead&&73===bite&&(state=states_Katakana),36!==lead||64!==bite&&66!==bite||(state=states_LeadByte),null!==state){iso2022jp_decoder_state=iso2022jp_decoder_state=state;var output_flag=iso2022jp_output_flag;return iso2022jp_output_flag=!0,output_flag?decoderError(fatal):null}return stream.prepend([lead,bite]),iso2022jp_output_flag=!1,iso2022jp_decoder_state=iso2022jp_decoder_output_state,decoderError(fatal)}}}function ISO2022JPEncoder(options){var fatal=options.fatal,states_ASCII=0,states_Roman=1,states_jis0208=2,iso2022jp_state=states_ASCII;this.handler=function(stream,code_point){if(code_point===end_of_stream&&iso2022jp_state!==states_ASCII)return stream.prepend(code_point),iso2022jp_state=states_ASCII,[27,40,66];if(code_point===end_of_stream&&iso2022jp_state===states_ASCII)return finished;if(!(iso2022jp_state!==states_ASCII&&iso2022jp_state!==states_Roman||14!==code_point&&15!==code_point&&27!==code_point))return encoderError(65533);if(iso2022jp_state===states_ASCII&&isASCIICodePoint(code_point))return code_point;if(iso2022jp_state===states_Roman&&(isASCIICodePoint(code_point)&&92!==code_point&&126!==code_point||165==code_point||8254==code_point)){if(isASCIICodePoint(code_point))return code_point;if(165===code_point)return 92;if(8254===code_point)return 126}if(isASCIICodePoint(code_point)&&iso2022jp_state!==states_ASCII)return stream.prepend(code_point),iso2022jp_state=states_ASCII,[27,40,66];if((165===code_point||8254===code_point)&&iso2022jp_state!==states_Roman)return stream.prepend(code_point),iso2022jp_state=states_Roman,[27,40,74];8722===code_point&&(code_point=65293);var pointer=indexPointerFor(code_point,index("jis0208")),lead,trail;return null===pointer?encoderError(code_point):iso2022jp_state!==states_jis0208?(stream.prepend(code_point),iso2022jp_state=states_jis0208,[27,36,66]):[floor(pointer/94)+33,pointer%94+33]}}function ShiftJISDecoder(options){var fatal=options.fatal,shiftjis_lead=0;this.handler=function(stream,bite){if(bite===end_of_stream&&0!==shiftjis_lead)return shiftjis_lead=0,decoderError(fatal);if(bite===end_of_stream&&0===shiftjis_lead)return finished;if(0!==shiftjis_lead){var lead=shiftjis_lead,pointer=null;shiftjis_lead=0;var offset=bite<127?64:65,lead_offset=lead<160?129:193;(inRange(bite,64,126)||inRange(bite,128,252))&&(pointer=188*(lead-lead_offset)+bite-offset);var code_point=null===pointer?null:indexCodePointFor(pointer,index("jis0208"));return null===code_point&&null!==pointer&&inRange(pointer,8836,10528)?57344+pointer-8836:(null===code_point&&isASCIIByte(bite)&&stream.prepend(bite),null===code_point?decoderError(fatal):code_point)}return isASCIIByte(bite)||128===bite?bite:inRange(bite,161,223)?65377+bite-161:inRange(bite,129,159)||inRange(bite,224,252)?(shiftjis_lead=bite,null):decoderError(fatal)}}function ShiftJISEncoder(options){var fatal=options.fatal;this.handler=function(stream,code_point){if(code_point===end_of_stream)return finished;if(isASCIICodePoint(code_point)||128===code_point)return code_point;if(165===code_point)return 92;if(8254===code_point)return 126;if(inRange(code_point,65377,65439))return code_point-65377+161;8722===code_point&&(code_point=65293);var pointer=indexShiftJISPointerFor(code_point);if(null===pointer)return encoderError(code_point);var lead=floor(pointer/188),lead_offset,trail=pointer%188,offset;return[lead+(lead<31?129:193),trail+(trail<63?64:65)]}}function EUCKRDecoder(options){var fatal=options.fatal,euckr_lead=0;this.handler=function(stream,bite){if(bite===end_of_stream&&0!==euckr_lead)return euckr_lead=0,decoderError(fatal);if(bite===end_of_stream&&0===euckr_lead)return finished;if(0!==euckr_lead){var lead=euckr_lead,pointer=null;euckr_lead=0,inRange(bite,65,254)&&(pointer=190*(lead-129)+(bite-65));var code_point=null===pointer?null:indexCodePointFor(pointer,index("euc-kr"));return null===pointer&&isASCIIByte(bite)&&stream.prepend(bite),null===code_point?decoderError(fatal):code_point}return isASCIIByte(bite)?bite:inRange(bite,129,254)?(euckr_lead=bite,null):decoderError(fatal)}}function EUCKREncoder(options){var fatal=options.fatal;this.handler=function(stream,code_point){if(code_point===end_of_stream)return finished;if(isASCIICodePoint(code_point))return code_point;var pointer=indexPointerFor(code_point,index("euc-kr")),lead,trail;return null===pointer?encoderError(code_point):[floor(pointer/190)+129,pointer%190+65]}}function convertCodeUnitToBytes(code_unit,utf16be){var byte1=code_unit>>8,byte2=255&code_unit;return utf16be?[byte1,byte2]:[byte2,byte1]}function UTF16Decoder(utf16_be,options){var fatal=options.fatal,utf16_lead_byte=null,utf16_lead_surrogate=null;this.handler=function(stream,bite){if(bite===end_of_stream&&(null!==utf16_lead_byte||null!==utf16_lead_surrogate))return decoderError(fatal);if(bite===end_of_stream&&null===utf16_lead_byte&&null===utf16_lead_surrogate)return finished;if(null===utf16_lead_byte)return utf16_lead_byte=bite,null;var code_unit;if(code_unit=utf16_be?(utf16_lead_byte<<8)+bite:(bite<<8)+utf16_lead_byte,utf16_lead_byte=null,null!==utf16_lead_surrogate){var lead_surrogate=utf16_lead_surrogate;return utf16_lead_surrogate=null,inRange(code_unit,56320,57343)?65536+1024*(lead_surrogate-55296)+(code_unit-56320):(stream.prepend(convertCodeUnitToBytes(code_unit,utf16_be)),decoderError(fatal))}return inRange(code_unit,55296,56319)?(utf16_lead_surrogate=code_unit,null):inRange(code_unit,56320,57343)?decoderError(fatal):code_unit}}function UTF16Encoder(utf16_be,options){var fatal=options.fatal;this.handler=function(stream,code_point){if(code_point===end_of_stream)return finished;if(inRange(code_point,0,65535))return convertCodeUnitToBytes(code_point,utf16_be);var lead=convertCodeUnitToBytes(55296+(code_point-65536>>10),utf16_be),trail=convertCodeUnitToBytes(56320+(code_point-65536&1023),utf16_be);return lead.concat(trail)}}function XUserDefinedDecoder(options){var fatal=options.fatal;this.handler=function(stream,bite){return bite===end_of_stream?finished:isASCIIByte(bite)?bite:63360+bite-128}}function XUserDefinedEncoder(options){var fatal=options.fatal;this.handler=function(stream,code_point){return code_point===end_of_stream?finished:isASCIICodePoint(code_point)?code_point:inRange(code_point,63360,63487)?code_point-63360+128:encoderError(code_point)}}Object.defineProperty&&(Object.defineProperty(TextDecoder.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),Object.defineProperty(TextDecoder.prototype,"fatal",{get:function(){return"fatal"===this._error_mode}}),Object.defineProperty(TextDecoder.prototype,"ignoreBOM",{get:function(){return this._ignoreBOM}})),TextDecoder.prototype.decode=function decode(input,options){var bytes;bytes="object"==typeof input&&input instanceof ArrayBuffer?new Uint8Array(input):"object"==typeof input&&"buffer"in input&&input.buffer instanceof ArrayBuffer?new Uint8Array(input.buffer,input.byteOffset,input.byteLength):new Uint8Array(0),options=ToDictionary(options),this._do_not_flush||(this._decoder=decoders[this._encoding.name]({fatal:"fatal"===this._error_mode}),this._BOMseen=!1),this._do_not_flush=Boolean(options.stream);for(var input_stream=new Stream(bytes),output=[],result;;){var token=input_stream.read();if(token===end_of_stream)break;if((result=this._decoder.handler(input_stream,token))===finished)break;null!==result&&(Array.isArray(result)?output.push.apply(output,result):output.push(result))}if(!this._do_not_flush){do{if((result=this._decoder.handler(input_stream,input_stream.read()))===finished)break;null!==result&&(Array.isArray(result)?output.push.apply(output,result):output.push(result))}while(!input_stream.endOfStream());this._decoder=null}function serializeStream(stream){return!includes(["UTF-8","UTF-16LE","UTF-16BE"],this._encoding.name)||this._ignoreBOM||this._BOMseen||(stream.length>0&&65279===stream[0]?(this._BOMseen=!0,stream.shift()):stream.length>0&&(this._BOMseen=!0)),codePointsToString(stream)}return serializeStream.call(this,output)},Object.defineProperty&&Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){return this._encoding.name.toLowerCase()}}),TextEncoder.prototype.encode=function encode(opt_string,options){opt_string=opt_string?String(opt_string):"",options=ToDictionary(options),this._do_not_flush||(this._encoder=encoders[this._encoding.name]({fatal:"fatal"===this._fatal})),this._do_not_flush=Boolean(options.stream);for(var input=new Stream(stringToCodePoints(opt_string)),output=[],result;;){var token=input.read();if(token===end_of_stream)break;if((result=this._encoder.handler(input,token))===finished)break;Array.isArray(result)?output.push.apply(output,result):output.push(result)}if(!this._do_not_flush){for(;(result=this._encoder.handler(input,input.read()))!==finished;)Array.isArray(result)?output.push.apply(output,result):output.push(result);this._encoder=null}return new Uint8Array(output)},encoders["UTF-8"]=function(options){return new UTF8Encoder(options)},decoders["UTF-8"]=function(options){return new UTF8Decoder(options)},"encoding-indexes"in global&&encodings.forEach(function(category){"Legacy single-byte encodings"===category.heading&&category.encodings.forEach(function(encoding){var name=encoding.name,idx=index(name.toLowerCase());decoders[name]=function(options){return new SingleByteDecoder(idx,options)},encoders[name]=function(options){return new SingleByteEncoder(idx,options)}})}),decoders.GBK=function(options){return new GB18030Decoder(options)},encoders.GBK=function(options){return new GB18030Encoder(options,!0)},encoders.gb18030=function(options){return new GB18030Encoder(options)},decoders.gb18030=function(options){return new GB18030Decoder(options)},encoders.Big5=function(options){return new Big5Encoder(options)},decoders.Big5=function(options){return new Big5Decoder(options)},encoders["EUC-JP"]=function(options){return new EUCJPEncoder(options)},decoders["EUC-JP"]=function(options){return new EUCJPDecoder(options)},encoders["ISO-2022-JP"]=function(options){return new ISO2022JPEncoder(options)},decoders["ISO-2022-JP"]=function(options){return new ISO2022JPDecoder(options)},encoders.Shift_JIS=function(options){return new ShiftJISEncoder(options)},decoders.Shift_JIS=function(options){return new ShiftJISDecoder(options)},encoders["EUC-KR"]=function(options){return new EUCKREncoder(options)},decoders["EUC-KR"]=function(options){return new EUCKRDecoder(options)},encoders["UTF-16BE"]=function(options){return new UTF16Encoder(!0,options)},decoders["UTF-16BE"]=function(options){return new UTF16Decoder(!0,options)},encoders["UTF-16LE"]=function(options){return new UTF16Encoder(!1,options)},decoders["UTF-16LE"]=function(options){return new UTF16Decoder(!1,options)},encoders["x-user-defined"]=function(options){return new XUserDefinedEncoder(options)},decoders["x-user-defined"]=function(options){return new XUserDefinedDecoder(options)},global.TextEncoder||(global.TextEncoder=TextEncoder),global.TextDecoder||(global.TextDecoder=TextDecoder),"undefined"!=typeof module&&module.exports&&(module.exports={TextEncoder:global.TextEncoder,TextDecoder:global.TextDecoder,EncodingIndexes:global["encoding-indexes"]})}(this);